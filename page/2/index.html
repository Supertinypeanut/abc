<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Peanut</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Peanut">
<meta property="og:url" content="https://supertinypeanut.github.io/blog/page/2/index.html">
<meta property="og:site_name" content="Peanut">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Super Peanut">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Peanut" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Peanut</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://supertinypeanut.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Element组件Tree实现高亮定位" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/08/23/Element%E7%BB%84%E4%BB%B6Tree%E5%AE%9E%E7%8E%B0%E9%AB%98%E4%BA%AE%E5%AE%9A%E4%BD%8D/" class="article-date">
  <time datetime="2020-08-23T17:10:10.000Z" itemprop="datePublished">2020-08-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/08/23/Element%E7%BB%84%E4%BB%B6Tree%E5%AE%9E%E7%8E%B0%E9%AB%98%E4%BA%AE%E5%AE%9A%E4%BD%8D/">Element组件Tree实现高亮定位</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="业务需求"><a href="#业务需求" class="headerlink" title="业务需求"></a>业务需求</h2><p>在再编辑回显时，需要<code>高亮</code>上次选中的值。当服务组（业务数据只有两层）小于十个时需要全部展开，且需要自动定位至用户可视区域（避免用户需要自己手动滑动寻找）。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="tree-配置"><a href="#tree-配置" class="headerlink" title="tree 配置"></a>tree 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">  class&#x3D;&quot;filter-tree&quot;</span><br><span class="line">  node-key&#x3D;&quot;id&quot;</span><br><span class="line">  :data&#x3D;&quot;serviceList&quot;</span><br><span class="line">  :props&#x3D;&quot;defaultProps&quot;</span><br><span class="line">  :default-expand-all&#x3D;&quot;isExpandAll&quot;</span><br><span class="line">  :filter-node-method&#x3D;&quot;filterNode&quot;</span><br><span class="line">  @current-change&#x3D;&quot;currentChange&quot;</span><br><span class="line">  highlight-current</span><br><span class="line">  ref&#x3D;&quot;tree&quot;</span><br><span class="line">&gt;</span><br><span class="line">&lt;&#x2F;el-tree&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>data</code>便是数据源</li>
<li><code>filter-node-method</code>实现关键词搜索（需求需要，实现高亮可以不配）</li>
<li><code>node-key=&quot;id&quot;</code>表示使用每个节点的”id”对应的值来表示每个节点(唯一的，使用 setCurrentKey 方法必须设置)</li>
<li><code>highlight-current&quot;</code>表示高亮选中的节点</li>
<li><code>props</code>设置为默认格式</li>
<li><code>default-expand-all</code>表示默认展开所有节点（需求需要动态判断服务组数（计算属性），实现高亮直接给 true 就行）</li>
<li><code>ref=&quot;tree&quot;</code>指代这颗树名为 tree</li>
</ul>
<h3 id="实现高亮"><a href="#实现高亮" class="headerlink" title="实现高亮"></a>实现高亮</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高亮选中节点</span></span><br><span class="line"><span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> eventTree: <span class="built_in">any</span> = <span class="keyword">this</span>.$refs.tree;</span><br><span class="line">  <span class="comment">// 需要高亮节点的id</span></span><br><span class="line">  eventTree.setCurrentKey(<span class="keyword">this</span>.processServiceData.eventId);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实现自动定位（必须要在高亮设置后在滚动，无效）</span></span><br><span class="line">  <span class="keyword">this</span>.scrollToCurrentNode();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>注意：</code>需要数据渲染后且 DOM 更新后才能设置成功，使用$nextTick</p>
<h3 id="实现定位"><a href="#实现定位" class="headerlink" title="实现定位"></a>实现定位</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改scroll位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">async</span> scrollToCurrentNode() &#123;</span><br><span class="line">  <span class="comment">// 下一个DOM修改时机</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">this</span>.$nextTick()</span><br><span class="line">  <span class="comment">//父组件</span></span><br><span class="line">  <span class="keyword">const</span> elDialog: <span class="built_in">any</span> = <span class="keyword">this</span>.$parent</span><br><span class="line">  <span class="keyword">const</span> elTreeOffsetElBody = <span class="number">80</span></span><br><span class="line">  <span class="keyword">const</span> tree: <span class="built_in">any</span> = <span class="keyword">this</span>.$refs.tree</span><br><span class="line">  <span class="keyword">const</span> currentNode = tree.$el.querySelector(<span class="string">'.el-tree-node.is-current'</span>)</span><br><span class="line">  <span class="keyword">const</span> dialogBody = elDialog.$el.querySelector(<span class="string">'.el-dialog__body'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 防止当前没有选中服务报错</span></span><br><span class="line">  <span class="keyword">if</span> (currentNode) &#123;</span><br><span class="line">    <span class="keyword">const</span> currentOffsetTop = currentNode.offsetTop + elTreeOffsetElBody</span><br><span class="line">    dialogBody.scrollTo(&#123;</span><br><span class="line">      top: currentOffsetTop,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>注意：</code>由于个人根据需求的组件设计风格，tree 的组件并不是直接扔在 dialog 中，而是再对其封装成只需 v-model 绑定组件。所以大家在取父子组件操作 DOM 时注意一下即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/08/23/Element%E7%BB%84%E4%BB%B6Tree%E5%AE%9E%E7%8E%B0%E9%AB%98%E4%BA%AE%E5%AE%9A%E4%BD%8D/" data-id="ckmm8va4m000185qs7raubmm2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" rel="tag">问题解决</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-XSS的攻防" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/08/16/XSS%E7%9A%84%E6%94%BB%E9%98%B2/" class="article-date">
  <time datetime="2020-08-16T17:10:10.000Z" itemprop="datePublished">2020-08-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/08/16/XSS%E7%9A%84%E6%94%BB%E9%98%B2/">XSS 的攻防</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>随着互联网的高速发展，web 应用在互联网中占据的位置也越来越重要，web 安全问题也自然成为了企业最关注的焦点之一。目前，针对 web 的攻击手段层出不穷（比如 SQL 注入、CSRF、XSS 等），虽然浏览器本身也在不断引入 CORS、CSP、Same-Site Cookies 等技术来增强安全性，但是仍存在很多潜在的威胁，需要技术人员不断进行“查漏补缺”。</p>
</blockquote>
<blockquote>
<p>在上述的威胁中，XSS（Crossing-Site Scripting，跨站脚本攻击）是困扰 Web 安全多年的一种常见攻击方式。我们本次主要针对 XSS 的原理和防御方案进行介绍</p>
</blockquote>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>XSS 是 Crossing-Site Scripting（跨站脚本）的英文首字母缩写，因为和 CSS（Cascading Style Sheets 层叠样式表）重名了，所以将 C 改成 X 以区分。</p>
<p>XSS 是一种代码注入攻击，攻击者可以往 Web 页面里插入恶意代码，当其他用户浏览该网页的时候，嵌入 web 里面的代码会被执行，从而达到攻击者特殊目的，比如：</p>
<ul>
<li><p>破坏网站，导致页面不可用</p>
</li>
<li><p>攻击服务端，导致服务拒绝</p>
</li>
<li><p>窃取用户 cookie，发送恶意请求</p>
</li>
<li><p>安装键盘记录器，窃取用户数据</p>
</li>
<li><p>跳转钓鱼页面，窃取账号密码</p>
</li>
<li><p>….</p>
</li>
</ul>
<p>XSS 触发的条件包括：</p>
<ol>
<li><p>攻击者可以<strong>提交恶意数据</strong></p>
</li>
<li><p><strong>数据没有被处理</strong>，直接展示到页面上（标签、标签属性、标签事件）</p>
</li>
<li><p><strong>其他用户可以访问</strong>该页面</p>
</li>
</ol>
<p><img src="/blog/.io//image-20200823161141603.png" alt="image-20200823161141603"></p>
<h3 id="由来"><a href="#由来" class="headerlink" title="由来"></a>由来</h3><p>介绍完 XSS 的基本概念后，我们来聊一聊 XSS 的历史。XSS 的由来已久，最早可以追溯到上个世纪 90 年代。</p>
<p>1995 年，网景公司为其 Netscape Navigator（网景导航者）浏览器引入 JavaScript，这改变了之前 Web 内容是静态 HTML 的状况。JS 使得网页的交互越来越频繁，促使了 web 的蓬勃发展，但是也带来了新的问题：JS 可以执行服务器发送的代码片段，存在恶意代码注入的巨大安全风险，网页里的恶意代码可以向另外一个服务发送数据。使得攻击者可以利用这个方法窃取敏感信息。</p>
<p>2000 年 2 月，CERT（卡内基梅隆大学计算机紧急回应小组协调中心） 公布了一份 XSS 最早的报告，记载了网页因为疏忽包含了恶意的 html 标签和脚本的案例，以及这些恶意代码会对用户造成什么影响。</p>
<p><strong>因为 RD 在开发时不可能对所有的用户输入都进行检测和处理，所以 XSS 是广泛长期存在的</strong>。根据<a href="https://github.com/OWASP/www-project-top-ten/blob/master/index.md" target="_blank" rel="noopener">OWASP</a><a href="https://github.com/OWASP/www-project-top-ten/blob/master/index.md" target="_blank" rel="noopener"> Top 10</a>的统计，XSS 每次都能抢到前排小板凳，2010 年位列第三、2013 年位列第三、2017 年位列第七。</p>
<p><img src="/blog/.io//image-20200823161309934.png" alt="image-20200823161309934"></p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>由于 XSS 漏洞很容易被开发忽略，互联网上已经爆发了多起恶劣攻击事件：</p>
<p>2005 年，19 岁的精神小伙萨米为了增加个人主页的关注量、认识更多的辣妹，在 Myspace 网站上发布了萨米蠕虫病毒。它在每个被感染的用户页面显示一行字串“but most of all, samy is my hero”，并将自己复制在该用户页面。在短短 20 个小时内，超过一百万用户被感染和传播，MySpace 被迫将网站彻底关闭来清理病毒。<a href="https://blog.csdn.net/ssergsw/article/details/9259743" target="_blank" rel="noopener">源码</a></p>
<p><img src="/blog/.io//image-20200823161344946.png" alt="image-20200823161344946"></p>
<p>2006 年，Paypal 遭到 XSS 攻击，攻击者将 PayPal 的访问者重定向到仿制的新页面，在新页面警告用户需要重新设置账号密码，窃取用户信用卡、登陆信息等隐私数据。</p>
<p>2011 年，新浪微博出现了一次比较大的 XSS 攻击事件。大量用户自动发送诸如：“郭美美事件的一些未注意到的细节”，“建党大业中穿帮的地方”，“让女人心动的 100 句诗歌”，“这是传说中的神仙眷侣啊”，“惊爆!范冰冰艳照真流出了”等等微博和私信，并自动关注一位名为 hellosamy 的用户。</p>
<p>2014 年，百度贴吧爆出 XSS 蠕虫漏洞，页面 onmouseovers 时会下载 XSS 脚本，如果是吧务不小心被蠕虫感染了，会在「贴吧意见反馈」里，每 8 秒批量发 100 条「百度 SB」的帖子；任何用户被感染后也会发一个标题比较羞耻的帖子。<a href="https://www.cnblogs.com/milantgh/p/3655112.html" target="_blank" rel="noopener">源码</a></p>
<p>分类</p>
<p>介绍完 XSS 的黑历史后，你是否对 XSS 稍有兴趣（认识更多的辣妹）？我们接下来会揭开 XSS 的面纱。</p>
<p>目前 XSS 的攻击形式主要分成三类：反射型、存储型、Dom Based 型</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>典型攻击步骤</th>
<th>常见场景</th>
<th>区别</th>
</tr>
</thead>
<tbody><tr>
<td><strong>反射型</strong></td>
<td>攻击者构造出包含恶意代码的特殊的 URL 用户登陆后，访问带有恶意代码的 URL 服务端取出 URL 上的恶意代码，拼接在 HTML 中返回浏览器用户浏览器收到响应后解析执行混入其中的恶意代码窃取敏感信息/冒充用户行为，完成 XSS 攻击</td>
<td>通过 URL 传递参数的功能，如网站搜索、跳转等</td>
<td>非持久型 xss 攻击，依赖于服务器对恶意请求的反射，仅对当次的页面访问产生影响恶意代码存在 URL 上经过后端，不经过数据库</td>
</tr>
<tr>
<td><strong>存储型</strong></td>
<td>攻击者将恶意代码提交到目标网站的数据库中用户登陆后，访问相关页面 URL 服务端从数据库中取出恶意代码，拼接在 HTML 中返回浏览器用户浏览器收到响应后解析执行混入其中的恶意代码窃取敏感信息/冒充用户行为，完成 XSS 攻击</td>
<td>带有用户保存数据的网站功能，比如论坛发帖、商品评价、用户私信等等。</td>
<td>持久型 xss，攻击者的数据会存储在服务端，攻击行为将伴随着攻击数据一直存在。恶意代码存在数据库经过后端，经过数据库</td>
</tr>
<tr>
<td><strong>DOM 型</strong></td>
<td>前端 JavaScript 取出 URL 中的恶意代码并执行窃取敏感信息/冒充用户行为，完成 XSS 攻击</td>
<td>页面 JS 获取数据后不做甄别，直接操作 DOM。一般见于从 URL、cookie、LocalStorage 中取内容的场景</td>
<td>取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞</td>
</tr>
</tbody></table>
<h2 id="如何防御"><a href="#如何防御" class="headerlink" title="如何防御"></a>如何防御</h2><h3 id="针对反射和存储型-XSS"><a href="#针对反射和存储型-XSS" class="headerlink" title="针对反射和存储型 XSS"></a>针对反射和存储型 XSS</h3><p>存储型和反射型 XSS 都是在后端取出恶意代码后，插入到响应 HTML 里的，预防这种漏洞主要是关注后端的处理。</p>
<h4 id="后端设置白名单，净化数据"><a href="#后端设置白名单，净化数据" class="headerlink" title="后端设置白名单，净化数据"></a><strong>后端设置白名单，净化数据</strong></h4><p>后端对于保存/输出的数据要进行过滤和转义，过滤的内容：比如 location、onclick、onerror、onload、onmouseover 、 script 、href 、 eval、setTimeout、setInterval 等，常见框架：<a href="https://github.com/microcosm-cc/bluemonday" target="_blank" rel="noopener">bluemonday</a>，<a href="https://jsoup.org/cookbook/cleaning-html/whitelist-sanitizer" target="_blank" rel="noopener">jsoup</a>等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">**String** unsafe =</span><br><span class="line"> "<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'http://example.com/'</span> <span class="attr">onclick</span>=<span class="string">'stealCookies()'</span>&gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>";</span><br><span class="line">**String** safe = **Jsoup**.clean(unsafe, **Whitelist**.basic());</span><br><span class="line">// now: <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://example.com/"</span> &gt;</span>Link<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>转义规则可见【DOM 型 XSS-数据充分转义】</p>
<h4 id="避免拼接-HTML，采用纯前端渲染"><a href="#避免拼接-HTML，采用纯前端渲染" class="headerlink" title="避免拼接 HTML，采用纯前端渲染"></a><strong>避免拼接 HTML，采用纯前端渲染</strong></h4><p>浏览器先加载一个静态 HTML，后续通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。纯前端渲染还需注意避免 DOM 型 XSS 漏洞</p>
<h3 id="针对-DOM-型-XSS"><a href="#针对-DOM-型-XSS" class="headerlink" title="针对 DOM 型 XSS"></a>针对 DOM 型 XSS</h3><p>DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。</p>
<h4 id="谨慎对待展示数据"><a href="#谨慎对待展示数据" class="headerlink" title="谨慎对待展示数据"></a>谨慎对待展示数据</h4><p>谨慎使用.innerHTML、.outerHTML、document.write() ，不要把不可信的数据作为 HTML 插到页面上。</p>
<p>DOM 中的内联事件监听器，如 location、onclick、onerror、onload、onmouseover 等，<a> 标签的 href 属性，JavaScript 的 eval()、setTimeout()、setInterval() 等，都能把字符串作为代码运行，很容易产生安全隐患，谨慎处理传递给这些 API 的字符串。</a></p>
<h4 id="数据充分转义，过滤恶意代码"><a href="#数据充分转义，过滤恶意代码" class="headerlink" title="数据充分转义，过滤恶意代码"></a><strong>数据充分转义，过滤恶意代码</strong></h4><p>需要根据具体场景使用不同的转义规则，前端插件 <a href="https://jsxss.com/zh/index.html" target="_blank" rel="noopener">xss.js</a>，<a href="https://github.com/cure53/DOMPurify" target="_blank" rel="noopener">DOMPurify</a></p>
<table>
<thead>
<tr>
<th>放置位置</th>
<th>例子</th>
<th>采取的编码</th>
<th>编码格式</th>
</tr>
</thead>
<tbody><tr>
<td>HTML 标签之间</td>
<td><div> 不可信数据 </div></td>
<td>HTML Entity 编码</td>
<td>&amp; –&gt; &amp;&lt; –&gt; &lt;&gt; –&gt; &gt;” –&gt; &quot;‘ –&gt; &#x27;/ –&gt; &#x2f;</td>
</tr>
<tr>
<td>HTML 标签的属性</td>
<td>&lt;input type=”text”value=” 不可信数据 ” /&gt;</td>
<td>HTML Attribute 编码</td>
<td>&amp;#xHH</td>
</tr>
<tr>
<td>JavaScript</td>
<td><script> var msg = ” 不可信数据 ” </script></td>
<td>JavaScript 编码</td>
<td>\xHH</td>
</tr>
<tr>
<td>CSS</td>
<td>&lt;div style=” width: 不可信数据 ” &gt; … </td>
<td>CSS 编码</td>
<td>\HH</td>
</tr>
<tr>
<td>URL 参数中</td>
<td>&lt;a href=”/page?p= 不可信数据 ” &gt;…</td>
<td>URL 编码</td>
<td>%HH</td>
</tr>
</tbody></table>
<p><strong>编码规则：</strong>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的 ASCII 码小于 256。编码后输出的格式为以上编码格式 （以&amp;#x、\x 、\、%开头，HH 则是指该字符对应的十六进制数字）</p>
<h4 id="使用插值表达式"><a href="#使用插值表达式" class="headerlink" title="使用插值表达式"></a><strong>使用插值表达式</strong></h4><p>采用 vue/react/angular 等技术栈时，使用插值表达式，避免使用 v-html。因为 template 转成 render function 的过程中，会把插值表达式作为 Text 文本内容进行渲染。<strong>在前端 render 阶段避免</strong> <strong>innerHTML**</strong>、*<strong>*outerHTML</strong> <strong>的 XSS 隐患。</strong></p>
<p>比如：</p>
<div class="a"><span></span></div>

<p>最终生成的代码如下</p>
<p><code>&quot;with(this){return _c(&#39;div&#39;,{staticClass:&quot;a&quot;},[_c(&#39;span&#39;,[_v(_s(item))])])}&quot;</code></p>
<p>_c 是 createElement 简写，即 render 函数，_v 是 createTextVNode 的简写，创建文本节点，_s 是 toString 简写</p>
<h3 id="其他措施"><a href="#其他措施" class="headerlink" title="其他措施"></a>其他措施</h3><h4 id="设置-Cookie-httpOnly"><a href="#设置-Cookie-httpOnly" class="headerlink" title="设置 Cookie httpOnly"></a><strong>设置 Cookie httpOnly</strong></h4><p>禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie</p>
<p><img src="/blog/.io//image-20200823161809436.png" alt="image-20200823161809436"></p>
<h4 id="设置-CSP（Content-Security-Policy）"><a href="#设置-CSP（Content-Security-Policy）" class="headerlink" title="设置 CSP（Content Security Policy）"></a><strong>设置 CSP（Content Security Policy）</strong></h4><p>CSP 的实质就是设置浏览器白名单，告诉浏览器哪些外部资源可以加载和执行，自动禁止外部注入恶意脚本。</p>
<p>CSP 可以通过两种方式来开启 ：</p>
<ol>
<li><ol>
<li>设置 html 的 meta 标签的方式</li>
</ol>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">http-equiv</span>=<span class="string">"Content-Security-Policy"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">"script-src 'self' *.example.com ; style-src 'self' ;"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><ol>
<li>设置 HTTP Header 中的 Content-Security-Policy</li>
</ol>
</li>
</ol>
<p><code>Content-Security-Policy: script-src &#39;self&#39; *.example.com ; style-src &#39;self&#39; ;</code></p>
<p>上述代码描述的 CSP 规则是 js 脚本只能来自当前域名和 example.com 二级域名下，css 只能来自当前域名</p>
<p>CSP 可以限制<strong>加载资源的类型</strong>：</p>
<table>
<thead>
<tr>
<th><strong>script-src</strong></th>
<th>外部脚本</th>
</tr>
</thead>
<tbody><tr>
<td><strong>style-src</strong></td>
<td>样式表</td>
</tr>
<tr>
<td><strong>img-src</strong></td>
<td>图像</td>
</tr>
<tr>
<td><strong>media-src</strong></td>
<td>媒体文件（音频和视频）</td>
</tr>
<tr>
<td><strong>font-src</strong></td>
<td>字体文件</td>
</tr>
<tr>
<td><strong>object-src</strong></td>
<td>插件（比如 Flash）</td>
</tr>
<tr>
<td><strong>child-src</strong></td>
<td>框架</td>
</tr>
<tr>
<td><strong>frame-ancestors</strong></td>
<td>嵌入的外部资源（比如<frame>、<iframe>、<embed>和<applet>）</applet></iframe></td>
</tr>
<tr>
<td><strong>connect-src</strong></td>
<td>HTTP 连接（通过 XHR、WebSockets、EventSource 等）</td>
</tr>
<tr>
<td><strong>worker-src</strong></td>
<td>worker 脚本</td>
</tr>
<tr>
<td><strong>manifest-src</strong></td>
<td>manifest 文件</td>
</tr>
<tr>
<td><strong>default-src</strong></td>
<td>用来设置上面各个选项的默认值</td>
</tr>
</tbody></table>
<p>同时也可设置<strong>资源的限制规则</strong></p>
<table>
<thead>
<tr>
<th>主机名</th>
<th><a href="http://example.org" target="_blank" rel="noopener">example.org</a>，<a href="https://example.com:443" target="_blank" rel="noopener">https://example.com:443</a></th>
</tr>
</thead>
<tbody><tr>
<td>路径名</td>
<td><a href="http://example.org/resources/js/" target="_blank" rel="noopener">example.org/resources/js/</a></td>
</tr>
<tr>
<td>通配符</td>
<td><em>.<a href="http://example.org" target="_blank" rel="noopener">example.org</a>，</em>://_.<a href="http://example.com" target="_blank" rel="noopener">example.com</a>:_（表示任意协议、任意子域名、任意端口）</td>
</tr>
<tr>
<td>协议名</td>
<td>https:、data:</td>
</tr>
<tr>
<td><strong>‘self’</strong></td>
<td>当前域名，需要加引号</td>
</tr>
<tr>
<td><strong>‘none’</strong></td>
<td>禁止加载任何外部资源，需要加引号</td>
</tr>
<tr>
<td><strong>‘unsafe-inline’</strong></td>
<td>允许执行页面内嵌的<script>标签和事件监听函数</td>
</tr>
<tr>
<td><strong>'unsafe-eval'</strong></td>
<td>允许将字符串当作代码执行，比如使用 eval、setTimeout、setInterval 和 Function 等函数</td>
</tr>
</tbody></table>
<p>严格的 CSP 在 XSS 的防范中可以起到以下的作用：</p>
<ul>
<li>禁止加载外域代码，防止复杂的攻击逻辑</li>
<li>禁止外域提交，网站被攻击后，用户的数据不会泄露到外域</li>
<li>禁止内联脚本执行</li>
<li>禁止未授权的脚本执行</li>
</ul>
<h4 id="输入内容长度、类型的控制"><a href="#输入内容长度、类型的控制" class="headerlink" title="输入内容长度、类型的控制"></a>输入内容长度、类型的控制</h4><p>对于不受信任的输入，都应该限定一个合理的长度，并且对输入内容的合法性进行校验（例如输入 email 的文本框只允许输入格式正确的 email，输入手机号码的文本框只允许填入数字且格式需要正确）。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。</p>
<h4 id="验证码，防止脚本冒充用户提交危险操作"><a href="#验证码，防止脚本冒充用户提交危险操作" class="headerlink" title="验证码，防止脚本冒充用户提交危险操作"></a><strong>验证码</strong>，防止脚本冒充用户提交危险操作</h4><h3 id="如何检测"><a href="#如何检测" class="headerlink" title="如何检测"></a>如何检测</h3><p>目前主要 2 种方式检测项目的 XSS 漏洞：</p>
<h4 id="使用通用-XSS-攻击字符串手动检测-XSS-漏洞"><a href="#使用通用-XSS-攻击字符串手动检测-XSS-漏洞" class="headerlink" title="使用通用 XSS 攻击字符串手动检测 XSS 漏洞"></a>使用通用 XSS 攻击字符串手动检测 XSS 漏洞</h4><p>在<a href="https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot" target="_blank" rel="noopener">Unleashing an Ultimate XSS Polyglot</a>一文中，有这么一个字符串：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jaVasCript:<span class="comment">/*-/*`/*\`/*'/*"/**/</span>(<span class="comment">/* */</span>oNcliCk=alert() )<span class="regexp">//%0D%0A%0d%0a//</span>&lt;<span class="regexp">/stYle/</span>&lt;<span class="regexp">/titLe/</span>&lt;<span class="regexp">/teXtarEa/</span>&lt;<span class="regexp">/scRipt/</span>--!&gt;<span class="string">\x3csVg/&lt;sVg/oNloAd=alert()//&gt;\x3e</span></span><br></pre></td></tr></table></figure>

<p>它能够检测到存在于 HTML 属性、HTML 文字内容、跳转链接、内联 JavaScript 字符串等多种上下文中的 XSS 漏洞，也能检测 eval()、setTimeout()、setInterval()、Function()、innerHTML、document.write() 等 DOM 型 XSS 漏洞。只要在网站的各输入框中提交这个字符串，或者把它拼接到 URL 参数上，就可以进行检测了。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://xxx/search?keyword=jaVasCript<span class="number">%3</span>A<span class="number">%2</span>F*-<span class="number">%2</span>F*<span class="number">%60</span><span class="number">%2</span>F*<span class="number">%60</span><span class="number">%2</span>F*<span class="number">%27</span><span class="number">%2</span>F*<span class="number">%22</span><span class="number">%2</span>F**<span class="number">%2</span>F(<span class="number">%2</span>F*<span class="number">%20</span>*<span class="number">%2</span>FoNcliCk<span class="number">%3</span>Dalert()<span class="number">%20</span>)<span class="number">%2</span>F<span class="number">%2</span>F<span class="number">%250</span>D<span class="number">%250</span>A<span class="number">%250</span>d<span class="number">%250</span>a<span class="number">%2</span>F<span class="number">%2</span>F<span class="number">%3</span>C<span class="number">%2</span>FstYle<span class="number">%2</span>F<span class="number">%3</span>C<span class="number">%2</span>FtitLe<span class="number">%2</span>F<span class="number">%3</span>C<span class="number">%2</span>FteXtarEa<span class="number">%2</span>F<span class="number">%3</span>C<span class="number">%2</span>FscRipt<span class="number">%2</span>F--!<span class="number">%3</span>E<span class="number">%3</span>CsVg<span class="number">%2</span>F<span class="number">%3</span>CsVg<span class="number">%2</span>FoNloAd<span class="number">%3</span>Dalert()<span class="number">%2</span>F<span class="number">%2</span>F<span class="number">%3</span>E<span class="number">%3</span>E</span><br></pre></td></tr></table></figure>

<h4 id="使用扫描工具自动检测-XSS-漏洞（BeEF、w3af-、-noXss等）"><a href="#使用扫描工具自动检测-XSS-漏洞（BeEF、w3af-、-noXss等）" class="headerlink" title="使用扫描工具自动检测 XSS 漏洞（BeEF、w3af 、 noXss等）"></a>使用扫描工具自动检测 XSS 漏洞（<a href="https://beefproject.com/" target="_blank" rel="noopener">BeEF</a>、<a href="https://github.com/andresriancho/w3af" target="_blank" rel="noopener">w3af</a> 、 <a href="https://github.com/lwzSoviet/NoXss" target="_blank" rel="noopener">noXss</a>等）</h4><p>大部分扫描工具是利用动态检测思想：寻找目标应用程序中所有可能出现漏洞的地方，包括表单中的输入框、富文本、密码等，然后构造特殊攻击字符串作为输入，模拟触发事件向服务器提交请求，然后获取服务器的 HTTP 相应，并在其中寻找之前构造的字符串，如果可以找到，说明服务器网页没有对输入过滤，也就是存在 XSS 漏洞。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>XSS 是一个比较大的话题，本篇文章主要介绍 XSS 的基本概念和常用防范手段。其他更多有意思的东西（比如 XSS 盲打、服务端标记 HTML 防 XSS 攻击、Ascii 编码绕过检测等），大家感兴趣的话可以再深入学习。</p>
<p>更多参考资料</p>
<ol>
<li><p>李冬萌. Web 前端安全问题的分析与防范研究[D]. 北京邮电大学, 2014.</p>
</li>
<li><p>万本钰. 基于浏览器的 XSS 检测系统的研究与设计[D]. 2019.</p>
</li>
<li><p>刘海, 徐芳, 郭帆, et al. 防范 XSS 攻击的研究综述[J]. 计算机与现代化, 2011, 2011(8):174-178.</p>
</li>
<li><p><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener">如何防止 XSS 攻击</a></p>
</li>
<li><p><a href="https://sking7.github.io/articles/430468050.html" target="_blank" rel="noopener">防御 XSS 的七条原则</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/lovesong/p/5211667.html" target="_blank" rel="noopener">HtmlEncode&JavaScriptEncode</a></p>
</li>
<li><p><a href="https://security.tencent.com/index.php/blog/msg/107" target="_blank" rel="noopener">DOMXSS 典型场景分析与修复指南</a></p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener">Content Security Policy</a></p>
</li>
<li><p><a href="https://www.freebuf.com/articles/web/153055.html" target="_blank" rel="noopener">XSS 过滤绕过速查表</a></p>
</li>
<li><p><a href="https://cloud.tencent.com/developer/article/1180217" target="_blank" rel="noopener">XSS 绕过方式</a></p>
</li>
</ol>
</script></td></tr></tbody></table>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/08/16/XSS%E7%9A%84%E6%94%BB%E9%98%B2/" data-id="ckmm8va92002585qs5z9zdpmb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/web-%E5%AE%89%E5%85%A8/" rel="tag">web 安全</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-代码Lint与格式化规范配置手册" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/08/13/%E4%BB%A3%E7%A0%81Lint%E4%B8%8E%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%A7%84%E8%8C%83%E9%85%8D%E7%BD%AE%E6%89%8B%E5%86%8C/" class="article-date">
  <time datetime="2020-08-13T10:10:10.000Z" itemprop="datePublished">2020-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/08/13/%E4%BB%A3%E7%A0%81Lint%E4%B8%8E%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%A7%84%E8%8C%83%E9%85%8D%E7%BD%AE%E6%89%8B%E5%86%8C/">代码Lint与格式化规范配置手册</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="代码-Lint-与格式化规范配置手册"><a href="#代码-Lint-与格式化规范配置手册" class="headerlink" title="代码 Lint 与格式化规范配置手册"></a>代码 Lint 与格式化规范配置手册</h2><h3 id="如何在项目中使用"><a href="#如何在项目中使用" class="headerlink" title="如何在项目中使用"></a>如何在项目中使用</h3><h4 id="npm-安装依赖"><a href="#npm-安装依赖" class="headerlink" title="npm 安装依赖"></a>npm 安装依赖</h4><blockquote>
<p>Lint 规则参考 <a href="https://alloyteam.github.io/eslint-config-alloy/" target="_blank" rel="noopener">https://alloyteam.github.io/eslint-config-alloy/</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-config-alloy eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue husky lint-staged prettier</span><br></pre></td></tr></table></figure>

<h4 id="package-json-中增加"><a href="#package-json-中增加" class="headerlink" title="package.json 中增加"></a>package.json 中增加</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">"husky": &#123;</span><br><span class="line"> "hooks": &#123;</span><br><span class="line">  "pre-commit": "lint-staged"</span><br><span class="line"> &#125;</span><br><span class="line">&#125;,</span><br><span class="line">"lint-staged": &#123;</span><br><span class="line"> "*.&#123;js,vue,ts&#125;": [</span><br><span class="line">  "eslint --fix",</span><br><span class="line">  <span class="string">"git add"</span></span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加-eslintrc-js-文件"><a href="#添加-eslintrc-js-文件" class="headerlink" title="添加.eslintrc.js 文件"></a>添加.eslintrc.js 文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  env: &#123;</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [<span class="string">"alloy"</span>, <span class="string">"alloy/typescript"</span>, <span class="string">"plugin:vue/essential"</span>, <span class="string">"prettier"</span>],</span><br><span class="line">  plugins: [<span class="string">"prettier"</span>],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">"@typescript-eslint/parser"</span>,</span><br><span class="line">    ecmaVersion: <span class="number">2017</span>,</span><br><span class="line">    sourceType: <span class="string">"module"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123;</span><br><span class="line">    eqeqeq: <span class="string">"off"</span>,</span><br><span class="line">    <span class="string">"prettier/prettier"</span>: <span class="string">"error"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="增加-editorconfig-文件"><a href="#增加-editorconfig-文件" class="headerlink" title="增加 .editorconfig 文件"></a>增加 .editorconfig 文件</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[*.&#123;js,jsx,ts,tsx,vue&#125;]</span></span><br><span class="line"><span class="attr">charset</span> = utf-<span class="number">8</span></span><br><span class="line"><span class="attr">end_of_line</span> = lf</span><br><span class="line"><span class="attr">indent_size</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">indent_style</span> = space</span><br><span class="line"><span class="attr">insert_final_newline</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">max_line_length</span> = <span class="number">120</span></span><br><span class="line"><span class="attr">tab_width</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">trim_trailing_whitespace</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="增加-prettierrc-js-文件"><a href="#增加-prettierrc-js-文件" class="headerlink" title="增加 .prettierrc.js 文件"></a>增加 .prettierrc.js 文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  trailingComma: <span class="string">"es5"</span>,</span><br><span class="line">  tabWidth: <span class="number">2</span>,</span><br><span class="line">  semi: <span class="literal">false</span>,</span><br><span class="line">  singleQuote: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="IDE-设置"><a href="#IDE-设置" class="headerlink" title="IDE 设置"></a>IDE 设置</h3><p>IDEA / Web Storm</p>
<h4 id="安装相关插件"><a href="#安装相关插件" class="headerlink" title="安装相关插件"></a><strong>安装相关插件</strong></h4><ol>
<li><p>Prettier</p>
</li>
<li><p>File Watcher</p>
</li>
</ol>
<p><strong>如何自动 Lint/格式化文件 参考：</strong></p>
<p><a href="https://prettier.io/docs/en/webstorm.html#running-prettier-on-save-using-file-watcher" target="_blank" rel="noopener">https://prettier.io/docs/en/webstorm.html#running-prettier-on-save-using-file-watcher</a></p>
<p><strong>检查项目是否启动 ESLint Prettier</strong></p>
<p><img src="/blog/.io//BpfwV0dLW8XppUnl29RMPvvb97GlyNO1uidpFXlFfIlwfuKQTD.png" alt="img"></p>
<p><img src="/blog/.io//2UZTIuCp1o1ukDpEbkWvSolCwA4njjCoPOSDaFDo8o9QZHGEeM.png" alt="img"></p>
<p><strong>手动格式化</strong></p>
<p>修改默认格式化快捷键为 Prettier</p>
<p><strong>关闭分号警告</strong></p>
<p>搜索 <strong>unterminated statement 然后去掉 ✔️ 如下图</strong></p>
<p><img src="/blog/.io//p7iI6Jb3sAMiLSqWCh8nPkAa4YzGQv3qQYg4y7WvPFJaxoCL5W.png" alt="img"></p>
<p>VS Code</p>
<p><strong>安装相关插件</strong></p>
<ol>
<li><p>Prettier</p>
</li>
<li><p>ESLint</p>
</li>
<li><p>EditorConfig</p>
</li>
</ol>
<p><strong>如何自动 Lint/格式化文件</strong></p>
<p>在 VSCode 中，默认 ESLint 并不能识别 .vue、.ts 或 .tsx 文件，需要在「文件 =&gt; 首选项 =&gt; 设置里做如下配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"eslint.validate"</span>: [</span><br><span class="line">    <span class="string">"javascript"</span>,</span><br><span class="line">    <span class="string">"javascriptreact"</span>,</span><br><span class="line">    <span class="string">"vue"</span>,</span><br><span class="line">    <span class="string">"typescript"</span>,</span><br><span class="line">    <span class="string">"typescriptreact"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要针对 .vue、.ts 和 .tsx 文件开启 ESLint 的 autoFix，则需要配置成：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"eslint.validate"</span>: [</span><br><span class="line">    <span class="string">"javascript"</span>,</span><br><span class="line">    <span class="string">"javascriptreact"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"language"</span>: <span class="string">"vue"</span>,</span><br><span class="line">      <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"language"</span>: <span class="string">"typescript"</span>,</span><br><span class="line">      <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"language"</span>: <span class="string">"typescriptreact"</span>,</span><br><span class="line">      <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Vue 文件格式化与 ESLint 冲突的问题</strong></p>
<p>修改下 vetur 的配置 保证 格式化使用 prettier</p>
<p><img src="/blog/.io//V5v8xLL92QIj5XMoJe9t8ImvaghPh0XYh63YTDqtWKspQX5iIl.png" alt="img"></p>
<p>以上设置成功后应该达到的效果</p>
<ol>
<li><p>编辑代码时能标出与 Lint 规则冲突的代码</p>
</li>
<li><p>文件保存时自动 Lint 并格式化代码</p>
</li>
<li><p>git commit 时自动检查暂存区代码是否符合 Lint/Prettier 不符合代码无法 commit</p>
</li>
</ol>
<p>对于旧代码不符合 Lint 规则的情况</p>
<p>以上设置后 Lint 规则只会扫描加入到 git 暂存区的文件，即当前修改的文件.如果需要修改旧代码则需要解决旧代码的 Lint 问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/08/13/%E4%BB%A3%E7%A0%81Lint%E4%B8%8E%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%A7%84%E8%8C%83%E9%85%8D%E7%BD%AE%E6%89%8B%E5%86%8C/" data-id="ckmm8va5o000x85qsb48agqau" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Lint/" rel="tag">Lint</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Nexus搭建npm 私服" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/08/12/Nexus%E6%90%AD%E5%BB%BAnpm%20%E7%A7%81%E6%9C%8D/" class="article-date">
  <time datetime="2020-08-12T10:10:10.000Z" itemprop="datePublished">2020-08-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/08/12/Nexus%E6%90%AD%E5%BB%BAnpm%20%E7%A7%81%E6%9C%8D/">Nexus搭建npm 私服</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Nexus-搭建-npm-私服"><a href="#Nexus-搭建-npm-私服" class="headerlink" title="Nexus 搭建 npm 私服"></a>Nexus 搭建 npm 私服</h2><h3 id="服务端部署-Nexus"><a href="#服务端部署-Nexus" class="headerlink" title="服务端部署 Nexus"></a>服务端部署 Nexus</h3><ul>
<li><h4 id="下载解压"><a href="#下载解压" class="headerlink" title="下载解压"></a>下载解压</h4><p>官方下载链接](<a href="https://help.sonatype.com/repomanager3/download" target="_blank" rel="noopener">help.sonatype.com/repomanager…</a>)，执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载</span></span><br><span class="line">$ wget https://download.sonatype.com/nexus/3/latest-unix.tar.gz</span><br><span class="line"><span class="comment">#移动到 /opt 目录</span></span><br><span class="line">$ sudo mv latest-unix.tar.gz /opt/nexus3.tar.gz</span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">$ sudo tar -xzvf nexus3.tar.gz</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意运行 Nexus 需要 Java 8 运行时环境(JRE)，请自行安装。</p>
</blockquote>
</li>
<li><h4 id="创建运行用户"><a href="#创建运行用户" class="headerlink" title="创建运行用户"></a>创建运行用户</h4><p>单独创建一个 nexus 用户用来运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建用户、指定用户目录、授权</span></span><br><span class="line">$ sudo useradd -d /home/nexus -m nexus</span><br><span class="line">$ sudo chown -R nexus:nexus /home/nexus</span><br><span class="line">$ sudo chown -R nexus:nexus /opt/nexus-3.15.2-01</span><br><span class="line">$ sudo chown -R nexus:nexus /opt/sonatype-work/</span><br></pre></td></tr></table></figure>

<p>修改运行用户配置项：修改 /opt/nexus-3.15.2-01/bin 目录下的配置文件 nexus.rc 为 <code>run_as_user=&quot;nexus&quot;</code></p>
</li>
<li><h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>修改端口指 8073 并开放 iptables 防火墙，对/opt/sonatype-work/nexus3/etc/nexus.properties 文件进行修改:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jetty section</span></span><br><span class="line">application-port=8073</span><br><span class="line">application-host=0.0.0.0                                                                 <span class="comment"># nexus-args=$&#123;jetty.etc&#125;/jetty.xml,$&#123;jetty.etc&#125;/jetty-http.xml,$&#123;jetty.etc&#125;/jetty-requestlog.xml</span></span><br><span class="line"><span class="comment"># nexus-context-path=/                                                                   # Nexus section                                                                         # nexus-edition=nexus-pro-edition                                                       # nexus-features=\                                                                       #  nexus-pro-feature</span></span><br></pre></td></tr></table></figure>

<p>启动服务，以下为 nexus 服务命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 nexus 服务</span></span><br><span class="line">$ sudo service nexus start</span><br><span class="line"><span class="comment"># 重启 nexus 服务</span></span><br><span class="line">$ sudo service nexus restart</span><br><span class="line"><span class="comment"># 停止 nexus 服务</span></span><br><span class="line">$ sudo service nexus stop</span><br><span class="line"><span class="comment"># 查看 nexus 服务状态</span></span><br><span class="line">$ sudo service nexus status</span><br></pre></td></tr></table></figure>

<p>查看日志检查服务状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f /opt/sonatype-work/nexus3/<span class="built_in">log</span>/nexus.log</span><br></pre></td></tr></table></figure>

<p>至此，nexus 服务已搭建完毕！可使用默认账号 admin/admin123 登录 ip:post 后对 npm 仓库进行管理</p>
</li>
</ul>
<p>![image-20200806002327294](Nexus 搭建 npm 私服.assets/image-20200806002327294.png)</p>
<ul>
<li><h4 id="仓库管理"><a href="#仓库管理" class="headerlink" title="仓库管理"></a>仓库管理</h4><p>创建仓库，npm 仓库有三种，这三种我们都需要创建</p>
</li>
</ul>
<p>![image-20200806002450572](Nexus 搭建 npm 私服.assets/image-20200806002450572.png)</p>
<ol>
<li><p>npm(proxy) - 代理 npm 仓库</p>
<p>将公共 npm 服务器的资源代理缓存，减少重复下载，加快开发人员和 CI 服务器的下载速度。</p>
<p>创建时需填写 Name(<code>npm-external</code>)和 Remote Storage(公有库地址，填写官方或淘宝镜像，<code>https://registry.npmjs.org/</code>)。</p>
<p>该仓库地址为：<code>http://ip:post/repository/npm-external/</code></p>
</li>
<li><p>npm(hosted) - 私有 npm 仓库</p>
<p>用于 上传自己的 npm 包 以及第三方 npm 包。</p>
<p>创建时只需填写 Name(<code>npm-internal</code>)。</p>
<p>该仓库地址为：<code>http://ip:post/repository/npm-internal/</code></p>
<blockquote>
<p>请注意：发布包时请将 registry 设为该地址。</p>
</blockquote>
</li>
<li><p>npm(group) - npm 仓库组</p>
<p>用于将多个内部或外部 npm 仓库统一为一个 npm 仓库。可以新建一个 npm 仓库组将 上面两个刚刚创建的两个 npm 仓库都添加进去。这样可以通过这个 npm 仓库组，既可以访问 公有 npm 仓库 又可以访问自己的 私有 npm 仓库。</p>
<p>创建时需填写 Name(<code>npm-all</code>)，然后选择需要添加到组里的 其他 npm 仓库(<code>npm-external</code>和<code>npm-internal</code>)。</p>
<p>该仓库地址为：<code>http://ip:post/repository/npm-all/</code></p>
<blockquote>
<p>请注意：安装包以及卸载包时请将 registry 设为该地址。</p>
</blockquote>
</li>
</ol>
<ul>
<li><h4 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h4><p>将包发布到 nexus npm 仓库需要设置一下 Nexus Repository Manager 的权限。否则无法登陆到我们的私服。在 Security-&gt;Realms 栏目里，将<code>npm Bearer Token Realm</code> 选入 Active。</p>
</li>
</ul>
<p>![image-20200806002525787](Nexus 搭建 npm 私服.assets/image-20200806002525787.png)</p>
<p>之后我们需要在 Security-&gt;Users 栏目里添加用户(<code>需要admin权限否则无法发包</code>)，只有这样添加的用户才可以发布包。经测试，在客户端使用 <code>npm adduser</code> 创建的用户没有发布权限。</p>
<blockquote>
<p>​ npm adduser 添加的用户信息需要时刚刚创建的 user 信息, 非私服可以使用<code>npm login</code>使用 npm 账号进行发布。</p>
</blockquote>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><h4 id="使用-nrm-管理-registry"><a href="#使用-nrm-管理-registry" class="headerlink" title="使用 nrm 管理 registry"></a>使用 nrm 管理 registry</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$npm</span> install -g nrm</span><br><span class="line"></span><br><span class="line">$ nrm ls</span><br><span class="line">* npm ---- https://registry.npmjs.org/</span><br><span class="line">  cnpm --- http://r.cnpmjs.org/</span><br><span class="line">  taobao - https://registry.npm.taobao.org/</span><br><span class="line">  nj ----- https://registry.nodejitsu.com/</span><br><span class="line">  rednpm - http://registry.mirror.cqupt.edu.cn/</span><br><span class="line">  npmMirror  https://skimdb.npmjs.com/registry/</span><br><span class="line">  edunpm - http://registry.enpmjs.org/</span><br><span class="line"></span><br><span class="line">$ nrm add ynpm http://XXXXXX:8888 <span class="comment"># 添加私服的npm镜像地址</span></span><br><span class="line">$ nrm use ynpm <span class="comment"># 使用私服的镜像地址</span></span><br></pre></td></tr></table></figure>

<h4 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm install lodash <span class="comment"># sinopia发现本地没有 lodash包,就会从 官方镜像下载</span></span><br><span class="line">npm --loglevel info install lodash  <span class="comment"># 设置loglevel 可查看下载包时的详细请求信息</span></span><br><span class="line"></span><br><span class="line">[storage]$ ls</span><br><span class="line"><span class="comment">#下载过之后，私服的storage目录下回缓存安装包</span></span><br><span class="line">[storage]$ ls</span><br><span class="line">lodash</span><br><span class="line"></span><br><span class="line">rm -rf node-modules <span class="comment"># 删除目录</span></span><br><span class="line">npm insatll lodash <span class="comment"># 第二次安装就会从缓存下载了,速度很快</span></span><br></pre></td></tr></table></figure>

<h4 id="制作包"><a href="#制作包" class="headerlink" title="制作包"></a>制作包</h4><p>包的制作其实很简单，只需要<code>npm init</code>初始化一个项目，配置<code>package.json</code>文件自己所需的信息即可，主要注意下<code>main</code>字段所指定的入口文件，也是导出文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="发布包与撤销发布包"><a href="#发布包与撤销发布包" class="headerlink" title="发布包与撤销发布包"></a>发布包与撤销发布包</h4><p>在项目根目录下运行<code>$ npm publish</code>发布新包。</p>
<p>运行<code>$ npm unpublish 包名 --force</code>撤销发布包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm publish</span><br></pre></td></tr></table></figure>

<p>查看发布的包，已成功发布：</p>
<p>![image-20200806002957482](Nexus 搭建 npm 私服.assets/image-20200806002957482.png)</p>
<h4 id="作用域-scope-管理发布包"><a href="#作用域-scope-管理发布包" class="headerlink" title="作用域 scope 管理发布包"></a>作用域 scope 管理发布包</h4><p>经常有看到<code>@xxx/yyy</code>类型的开源 npm 包，原因是包名称难免会有重名，如果已经有人在 <code>npm</code> 上注册该包名，再次 <code>npm publish</code> 同名包时会告知发布失败，这时可以通过 <code>scope</code> 作用域来解决</p>
<ul>
<li><p>定义作用域包</p>
<p>修改 package.json 中包名称：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     <span class="attr">"name"</span>: <span class="string">"@username/project-name"</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，如果是发布到官方 registry，scope 一定要是自己注册的用户名，而如果是发布到自己的 npm 私服，scope 可以不是用户名</p>
</blockquote>
</li>
<li><p>发布作用域包</p>
<p>作用域模块默认发布是私有的</p>
<p>发布到官方 registry 时，直接<code>npm publish</code>会报错，原因是只有付费用户才能发布私有 scope 包，免费用户只能发布公用包，因此需要添加 <code>access=public</code> 参数；</p>
<p>发布到自己的 npm 私服时，不加<code>access=public</code>参数也可以发布</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish --access=public</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用作用域包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @username/project-name</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/08/12/Nexus%E6%90%AD%E5%BB%BAnpm%20%E7%A7%81%E6%9C%8D/" data-id="ckmm8va4q000385qsgj8326kv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/npm/" rel="tag">npm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-TypeScript进阶-类型编程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/08/10/TypeScript%E8%BF%9B%E9%98%B6-%E7%B1%BB%E5%9E%8B%E7%BC%96%E7%A8%8B/" class="article-date">
  <time datetime="2020-08-10T10:10:10.000Z" itemprop="datePublished">2020-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/08/10/TypeScript%E8%BF%9B%E9%98%B6-%E7%B1%BB%E5%9E%8B%E7%BC%96%E7%A8%8B/">TypeScript 进阶——类型编程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="TypeScript-进阶——类型编程"><a href="#TypeScript-进阶——类型编程" class="headerlink" title="TypeScript 进阶——类型编程"></a>TypeScript 进阶——类型编程</h2><p>TypeScript 在某个层面上可以称作 Type + JavaScript，那么抛开 JavaScript，Type 是完备的编程语言吗？我们是否可以对类型进行编程呢？本文介绍一些 ts 特性和工具，期望一窥类型的乐趣。</p>
<blockquote>
<p>PS：建议将代码放到 IDE 或* <a href="https://www.typescriptlang.org/play/" target="_blank" rel="noopener"><em>TS playground</em></a><em>里查看类型提示。\</em></p>
</blockquote>
<p>Generics (泛型)</p>
<p>主流的编程语言通常都支持泛型以提供更加出色的抽象能力 (手动艾特 Go)，TypeScript 也不免俗。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapArr = &lt;T&gt;(v: T): T[] =&gt; [v];</span><br><span class="line"><span class="keyword">const</span> outputA = wrapArr(<span class="string">"aa"</span>); <span class="comment">// string[]</span></span><br><span class="line"><span class="keyword">const</span> outputB = wrapArr(<span class="number">1</span>); <span class="comment">// number[]</span></span><br></pre></td></tr></table></figure>

<p>完备的编程语言函数是必不可少的。本质上，泛型可以理解成类型层面的函数，当我们指定具体的输入类型时，得到的结果是经过处理后的输出类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> identity = <span class="function">(<span class="params">x</span>) =&gt;</span> x; <span class="comment">// value level</span></span><br><span class="line"><span class="keyword">type</span> Identity&lt;T&gt; = T; <span class="comment">// Type level</span></span><br><span class="line"><span class="keyword">const</span> pair = <span class="function">(<span class="params">x, y</span>) =&gt;</span> [x, y];</span><br><span class="line"><span class="keyword">type</span> Pair&lt;T, U&gt; = [T, U];</span><br></pre></td></tr></table></figure>

<p>泛型也起到约束和推导，举个例子</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = &lt;T, U&gt;<span class="function">(<span class="params">arr: T[], cb: (<span class="params">v: T, i: <span class="built_in">number</span></span>) =&gt; U</span>): <span class="params">U</span>[] =&gt;</span> &#123;<span class="comment">/* map 实现 */</span>&#125;</span><br></pre></td></tr></table></figure>

<p>那么函数已经有了，我们还需要一些工具函数帮助编程。</p>
<p>Utility Types</p>
<p>TypeScript 内置了很多工具类型，帮助开发者做类型变换（编程）。以下举几个例子，更多可看<a href="https://www.typescriptlang.org/docs/handbook/utility-types.html" target="_blank" rel="noopener">官方文档</a></p>
<p>Partial<T>, Required<T></T></T></p>
<p>将 T 的所有属性变成可选/必选。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Foo &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Bar = Partial&lt;Foo&gt;;</span><br><span class="line"><span class="comment">// Bar =&gt; &#123;</span></span><br><span class="line"><span class="comment">//  name?: string</span></span><br><span class="line"><span class="comment">//  age?: number</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">type</span> LikeFoo = Required&lt;Bar&gt;;</span><br><span class="line"><span class="comment">// LikeFoo is same as Foo</span></span><br></pre></td></tr></table></figure>

<p>Pick&lt;T, U&gt;, Omit&lt;T, U&gt;</p>
<p>从一个类型中获得子集。在组件 Props 透传时，常用于生成子组件的 Props 类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ParentProps &#123;</span><br><span class="line">  color: <span class="built_in">string</span>;</span><br><span class="line">  size: <span class="built_in">number</span>;</span><br><span class="line">  label: <span class="built_in">string</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  options: <span class="built_in">string</span>[];</span><br><span class="line">  placeholder?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Child1Key = <span class="string">"color"</span> | <span class="string">"size"</span> | <span class="string">"label"</span>;</span><br><span class="line"><span class="keyword">type</span> Child1Props = Pick&lt;ParentProps, Child1Key&gt;;</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   color: string</span></span><br><span class="line"><span class="comment">//   size: number</span></span><br><span class="line"><span class="comment">//   label: string</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">type</span> Child2Props = Omit&lt;ParentProps, Child1Key&gt;;</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   name: string</span></span><br><span class="line"><span class="comment">//   options: string[]</span></span><br><span class="line"><span class="comment">//   placeholder?: string</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p>Exclude&lt;T, U&gt;, Extract&lt;T, U&gt;</p>
<p>在 T 中排除/抽取匹配 U 的类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T0 = Exclude&lt;<span class="string">"a"</span> | <span class="string">"b"</span> | <span class="string">"c"</span>, <span class="string">"a"</span> | <span class="string">"b"</span>&gt;; <span class="comment">// "c"</span></span><br><span class="line"><span class="keyword">type</span> T1 = Exclude&lt;<span class="built_in">string</span> | <span class="built_in">number</span> | <span class="function">(<span class="params">(<span class="params"></span>) =&gt; <span class="built_in">void</span></span>), <span class="params">Function</span>&gt;; // <span class="params">string</span> | <span class="params">number</span></span></span><br><span class="line"><span class="function"><span class="params">type</span> <span class="params">T2</span> = <span class="params">Extract</span>&lt;"<span class="params">a</span>" | "<span class="params">b</span>" | "<span class="params">c</span>", "<span class="params">c</span>"&gt;; // "<span class="params">c</span>"</span></span><br></pre></td></tr></table></figure>

<p>Parameters<T>, ReturnType<T></T></T></p>
<p>获得函数的参数类型和返回类型。可用于获得未暴露出来的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// util.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> sum = <span class="function">(<span class="params">...p: <span class="built_in">number</span>[]</span>) =&gt;</span> p.reduce(<span class="function">(<span class="params">r, v</span>) =&gt;</span> r + v, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">'util'</span></span><br><span class="line">Parameters&lt;<span class="keyword">typeof</span> sum&gt; <span class="comment">// =&gt; number[]</span></span><br><span class="line">ReturnType&lt;<span class="keyword">typeof</span> sum&gt; <span class="comment">// =&gt; number</span></span><br></pre></td></tr></table></figure>

<p>与 lodash 的工具函数一样，这些工具类型可以通过 ts 本身的特性实现，下文着重介绍以上几个工具类型的实现。</p>
<p>类型操作符</p>
<p>先介绍几个常用的操作符</p>
<ol>
<li><p>in，与 JavaScript 的 in 类似，用于遍历</p>
</li>
<li><p>keyof，获取一个类型的所有键值。最终得到一个联合类型，类似 Object.keys</p>
</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Pick&lt;T, U <span class="keyword">extends</span> keyof T&gt; = &#123; [K <span class="keyword">in</span> U]: T[K] &#125;;</span><br><span class="line"><span class="keyword">type</span> Partial&lt;T&gt; = &#123; [K <span class="keyword">in</span> keyof T]?: T[K] &#125;;</span><br><span class="line"><span class="keyword">type</span> Required&lt;T&gt; = &#123; [K <span class="keyword">in</span> keyof T]-?: T[K] &#125;;</span><br></pre></td></tr></table></figure>

<p>Conditional Type (条件类型)</p>
<p>条件判断是编程语言基础的功能之一。TS 可以用条件类型来实现。条件类型一般形式是 T extends U ? X : Y ，和 JavaScript 的三元表达式一致，其中条件部分 T extends U 表示 T 是 U 的子集，即 T 类型的所有取值都包含在 U 类型中。</p>
<p>首先可以利用条件类型实现几个工具类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Exclude&lt;T, U&gt; = T <span class="keyword">extends</span> U ? never : T;</span><br><span class="line"><span class="keyword">type</span> Extract&lt;T, U&gt; = T <span class="keyword">extends</span> U ? T : never;</span><br></pre></td></tr></table></figure>

<p>再举个实际的案例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">text: <span class="built_in">string</span> | <span class="literal">null</span></span>): <span class="title">string</span> | <span class="title">null</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> text &amp;&amp; text.replace(<span class="regexp">/f/g</span>, <span class="string">"p"</span>);</span><br><span class="line">&#125;</span><br><span class="line">process(<span class="string">"hello world"</span>).toUpperCase(); <span class="comment">// Type Error!</span></span><br></pre></td></tr></table></figure>

<p>由于欠缺输入类型和输出类型之间的关联关系，导致即便输入是字符串时 TypeScript 仍然不能推断出输出是字符串，最终编译报错。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">string</span> | <span class="title">null</span>&gt;(<span class="params">text: T</span>): <span class="title">T</span> <span class="title">extends</span> <span class="title">string</span> ? <span class="title">string</span> : <span class="title">null</span> </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> text &amp;&amp; text.replace(<span class="regexp">/f/g</span>, <span class="string">'p'</span>);</span><br><span class="line">&#125;</span><br><span class="line">process(<span class="string">'foo'</span>).toUpperCase(); *<span class="comment">// Okay.*</span></span><br><span class="line">process(<span class="literal">null</span>).toUpperCase(); <span class="comment">// Type Error!</span></span><br></pre></td></tr></table></figure>

<p>infer</p>
<p>infer 是条件类型的补充，表示待推断的类型。举个例子</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Parameters&lt;T&gt; = T <span class="keyword">extends</span> (...args: infer U) =&gt; <span class="built_in">any</span> ? U : never;</span><br><span class="line"><span class="keyword">type</span> ReturnType&lt;T&gt; = T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; infer U ? U : never;</span><br></pre></td></tr></table></figure>

<p>在上面的条件类型中，infer U 表示待推断的函数参数类型。</p>
<p>infer 可以用于很多 unpack 的场景中</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Unpacked&lt;T&gt; = T <span class="keyword">extends</span> (infer U)[]</span><br><span class="line">  ? U</span><br><span class="line">  : T <span class="keyword">extends</span> Set&lt;infer U&gt;</span><br><span class="line">  ? U</span><br><span class="line">  : T <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;infer U&gt;</span><br><span class="line">  ? U</span><br><span class="line">  : T;</span><br></pre></td></tr></table></figure>

<p>图灵完备</p>
<p>有了类型层面的函数（泛型）、条件语句（条件类型）、递归等功能之后， 我们不禁有一个疑问：TypeScript 能够描述所有的数据类型吗？Github 有类似的讨论：<a href="https://github.com/Microsoft/TypeScript/issues/14833" target="_blank" rel="noopener">TypeScript 是图灵完备的</a>。</p>
<blockquote>
<p>TypeScript 包含了一套完整的类型层面编程能力，就像我们可以用 JavaScript、C++、Go 等编程语言解决各种实际问题一样，TypeScript 可以解决各种类型问题，因为本质上它们的内核都和图灵机等价。</p>
</blockquote>
<p>拾遗</p>
<p>类型编程与实际业务编程一样充满乐趣。类型体操就像瑜伽/JOJO 立一样，容易沉迷，可谓一直凹类型一直爽。</p>
<p>双手供上一道类型题（leetcode 的笔试题），所谓实践出真知。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现一个 Connect 类型，将下面 Module 转换成 Result</span></span><br><span class="line"><span class="keyword">interface</span> Action&lt;T&gt; &#123;</span><br><span class="line">  payload?: T;</span><br><span class="line">  <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> Module &#123;</span><br><span class="line">  count: <span class="built_in">number</span>;</span><br><span class="line">  message: <span class="built_in">string</span>;</span><br><span class="line">  asyncMethod&lt;T, U&gt;(input: <span class="built_in">Promise</span>&lt;T&gt;): <span class="built_in">Promise</span>&lt;Action&lt;U&gt;&gt;;</span><br><span class="line">  syncMethod&lt;T, U&gt;(action: Action&lt;T&gt;): Action&lt;U&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Result = &#123;</span><br><span class="line">  asyncMethod&lt;T, U&gt;(input: T): Action&lt;U&gt;;</span><br><span class="line">  syncMethod&lt;T, U&gt;(action: T): Action&lt;U&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/08/10/TypeScript%E8%BF%9B%E9%98%B6-%E7%B1%BB%E5%9E%8B%E7%BC%96%E7%A8%8B/" data-id="ckmm8va4y000885qs6m6ech24" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/TypeScript/" rel="tag">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-项目git使用规范" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/08/03/%E9%A1%B9%E7%9B%AEgit%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83/" class="article-date">
  <time datetime="2020-08-03T10:10:10.000Z" itemprop="datePublished">2020-08-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/08/03/%E9%A1%B9%E7%9B%AEgit%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83/">项目git使用规范</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="项目-git-使用规范"><a href="#项目-git-使用规范" class="headerlink" title="项目 git 使用规范"></a>项目 git 使用规范</h3><h4 id="分支规范"><a href="#分支规范" class="headerlink" title="分支规范"></a>分支规范</h4><h5 id="功能分支"><a href="#功能分支" class="headerlink" title="功能分支"></a>功能分支</h5><p>feature-(姓名简称)-(jira 号/任务 ID)</p>
<p>feature-jzh-XXXXXXXID</p>
<h5 id="上线分支"><a href="#上线分支" class="headerlink" title="上线分支"></a>上线分支</h5><p>release-(年月日)</p>
<p>release-20200803</p>
<h5 id="冲突分支"><a href="#冲突分支" class="headerlink" title="冲突分支"></a>冲突分支</h5><p>conflict-(姓名简称)-(年月日)</p>
<p>conflict-jzh-20200803</p>
<p>conflict-jzh-20200803-1</p>
<h5 id="测试-灰度修复分支"><a href="#测试-灰度修复分支" class="headerlink" title="测试/灰度修复分支"></a>测试/灰度修复分支</h5><p>bugfix-(jira 号/任务 ID)</p>
<h5 id="线上修复分支"><a href="#线上修复分支" class="headerlink" title="线上修复分支"></a>线上修复分支</h5><p>hotfix-(年月日)</p>
<p>hotfix-20200803</p>
<h4 id="Commit-Message-规范"><a href="#Commit-Message-规范" class="headerlink" title="Commit Message 规范"></a>Commit Message 规范</h4><figure class="highlight plain"><figcaption><span>basic</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">feat: 新特性</span><br><span class="line">fix: 修改问题</span><br><span class="line">refactor: 代码重构</span><br><span class="line">docs: 文档修改</span><br><span class="line">style: 代码格式修改, 注意不是 css 修改</span><br><span class="line">test: 测试用例修改</span><br><span class="line">chore: 其他修改, 比如构建流程, 依赖管理.</span><br></pre></td></tr></table></figure>

<p>在 commit 的时候需要增加上面中的类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"fix: 解决xxxxxxx问题"</span></span><br></pre></td></tr></table></figure>

<h4 id="Merge-Request-规范"><a href="#Merge-Request-规范" class="headerlink" title="Merge Request 规范"></a>Merge Request 规范</h4><p>标题格式为：</p>
<figure class="highlight plain"><figcaption><span>basic</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[jiraID&#x2F;任务ID][姓名]feat:描述</span><br><span class="line">注意是英文字符的中括号 []</span><br></pre></td></tr></table></figure>

<h4 id="Code-Review"><a href="#Code-Review" class="headerlink" title="Code Review"></a>Code Review</h4><p>由项目 Leader/同事 进行 review 代码，review 完成之后 进行评论 LGFM 后合并分支</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/08/03/%E9%A1%B9%E7%9B%AEgit%E4%BD%BF%E7%94%A8%E8%A7%84%E8%8C%83/" data-id="ckmm8va6s001g85qsd96q9w3j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Git/" rel="tag">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-刚clone下来的项目，submodule更新不成功" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/07/15/%E5%88%9Aclone%E4%B8%8B%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8Csubmodule%E6%9B%B4%E6%96%B0%E4%B8%8D%E6%88%90%E5%8A%9F/" class="article-date">
  <time datetime="2020-07-15T10:10:10.000Z" itemprop="datePublished">2020-07-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/07/15/%E5%88%9Aclone%E4%B8%8B%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8Csubmodule%E6%9B%B4%E6%96%B0%E4%B8%8D%E6%88%90%E5%8A%9F/">刚clone下来项目，submodule更新不成功</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="刚-clone-下来项目，submodule-更新不成功"><a href="#刚-clone-下来项目，submodule-更新不成功" class="headerlink" title="刚 clone 下来项目，submodule 更新不成功"></a>刚 clone 下来项目，submodule 更新不成功</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>开发过程中，我们可能会引入一个公共库来提供工程来使用，而公共代码库的版本管理是个麻烦的事情。我并遇到在 clone 一个项目到本地，在启动该项目前需要将该工程的子模块仓库下载下来。执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --init --recursive</span><br></pre></td></tr></table></figure>

<p>但遇到下面这个报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fatal: No url found <span class="keyword">for</span> submodule path <span class="string">'子模块名称'</span> <span class="keyword">in</span> .gitmodules</span><br><span class="line">npm ERR! code ELIFECYCLE</span><br><span class="line">npm ERR! errno 128</span><br><span class="line">npm ERR! 项目名 install-submodule: `git submodule update --init --recursive`</span><br><span class="line">npm ERR! Exit status 128</span><br><span class="line">npm ERR!</span><br><span class="line">npm ERR! Failed at the 项目名 install-submodule script.</span><br><span class="line">npm ERR! This is probably not a problem with npm. There is likely additional logging output above.</span><br></pre></td></tr></table></figure>

<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 逆初始化模块，其中&#123;MOD_NAME&#125;为模块目录，执行后可发现模块目录被清空</span></span><br><span class="line">git submodule deinit 子模块名</span><br><span class="line"><span class="comment"># 删除.gitmodules中记录的模块信息（--cached选项清除.git/modules中的缓存）</span></span><br><span class="line">git rm --cached 子模块名</span><br></pre></td></tr></table></figure>

<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>为当前工程添加 submodule，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add 仓库地址 路径</span><br></pre></td></tr></table></figure>

<p>其中，仓库地址是指子模块仓库地址，路径指将子模块放置在当前工程下的路径。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/07/15/%E5%88%9Aclone%E4%B8%8B%E6%9D%A5%E7%9A%84%E9%A1%B9%E7%9B%AE%EF%BC%8Csubmodule%E6%9B%B4%E6%96%B0%E4%B8%8D%E6%88%90%E5%8A%9F/" data-id="ckmm8va5p000z85qs3wot4xro" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Git/" rel="tag">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-webpack学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/07/10/webpack%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time datetime="2020-07-10T17:10:10.000Z" itemprop="datePublished">2020-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/07/10/webpack%E5%AD%A6%E4%B9%A0/">Webpack学习-深入浅出</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Webpack学习-深入浅出"><a href="#Webpack学习-深入浅出" class="headerlink" title="Webpack学习-深入浅出"></a>Webpack学习-深入浅出</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote>
<p><strong>webpack</strong> 是一个用于现代 JavaScript 应用程序的<em>静态模块打包工具</em></p>
</blockquote>
<ul>
<li><p>Webpack是提升前端生产力的利器</p>
<p><code>个人觉得 Webpack 应该是现代化前端开发的基石，也是目前前端生产力的代名词。</code></p>
</li>
<li><p>Webpack 与模块化开发</p>
<p><code>随着前端应用的日益复杂化，我们的项目已经逐渐膨胀到了不得不花大量时间去管理的程度。而模块化就是一种最主流的项目组织方式，它通过把复杂的代码按照功能划分为不同的模块单独维护，从而提高开发效率、降低维护成本。</code></p>
</li>
</ul>
<h3 id="Webpack核心特点"><a href="#Webpack核心特点" class="headerlink" title="Webpack核心特点"></a>Webpack核心特点</h3><h4 id="使用-Webpack-实现模块化打包"><a href="#使用-Webpack-实现模块化打包" class="headerlink" title="使用 Webpack 实现模块化打包"></a>使用 Webpack 实现模块化打包</h4><p>目前，前端领域有一些工具能够很好的满足以上这 3 个需求，其中最为主流的就是 Webpack、Parcel 和 Rollup，我们以 Webpack 为例：</p>
<ul>
<li><p>Webpack 作为一个模块打包工具，本身就可以解决模块化代码打包的问题，将零散的 JavaScript 代码打包到一个 JS 文件中。</p>
</li>
<li><p>对于有环境兼容问题的代码，Webpack 可以在打包过程中通过 Loader 机制对其实现编译转换，然后再进行打包。</p>
</li>
<li><p>对于不同类型的前端模块类型，Webpack 支持在 JavaScript 中以模块化的方式载入任意类型的资源文件，例如，我们可以通过 Webpack 实现在 JavaScript 中加载 CSS 文件，被加载的 CSS 文件将会通过 style 标签的方式工作。</p>
</li>
</ul>
<h5 id="Webpack-快速上手"><a href="#Webpack-快速上手" class="headerlink" title="Webpack 快速上手"></a>Webpack 快速上手</h5><p>安装 Webpack 的核心模块以及它的 CLI 模块，具体操作如下：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes</span><br><span class="line">npm i webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure>

<blockquote>
<p>webpack 是 Webpack 的核心模块，webpack-cli 是 Webpack 的 CLI 程序，用来在命令行中调用 Webpack。</p>
</blockquote>
<p>安装完成之后，webpack-cli 所提供的 CLI 程序就会出现在 node_modules/.bin 目录当中，我们可以通过 npx 快速找到 CLI 并运行它，具体操作如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --version</span><br><span class="line"></span><br><span class="line">npx 是 npm 5.2 以后新增的一个命令，可以用来更方便的执行远程模块或者项目 node_modules 中的 CLI 程序。</span><br></pre></td></tr></table></figure>

<p>运行 webpack 命令来打包 JS 模块代码，具体操作如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p>这个命令在执行的过程中，Webpack 会自动从 src/index.js 文件开始打包，然后根据代码中的模块导入操作，自动将所有用到的模块代码打包到一起。</p>
<p>对于 Webpack 最基本的使用，总结下来就是：先安装 webpack 相关的 npm 包，然后使用 webpack-cli 所提供的命令行工具进行打包。</p>
<h5 id="配置-Webpack-的打包过程"><a href="#配置-Webpack-的打包过程" class="headerlink" title="配置 Webpack 的打包过程"></a>配置 Webpack 的打包过程</h5><blockquote>
<p>详细的文档你可以在 Webpack 的官网中找到：<a href="https://webpack.js.org/configuration/#options" target="_blank" rel="noopener">https://webpack.js.org/configuration/#options</a></p>
</blockquote>
<p>在这里，我想跟你分享我在编写 Webpack 配置文件时用过的一个小技巧，因为 Webpack 的配置项比较多，而且很多选项都支持不同类型的配置方式。即便没有使用 TypeScript 这种类型友好的语言，也可以通过类型注释的方式去标注变量的类型。</p>
<p>默认 VSCode 并不知道 Webpack 配置对象的类型，我们通过 import 的方式导入 Webpack 模块中的 Configuration 类型，然后根据类型注释的方式将变量标注为这个类型，这样我们在编写这个对象的内部结构时就可以有正确的智能提示了，具体代码如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Configuration &#125; <span class="keyword">from</span> <span class="string">'webpack'</span> <span class="comment">// 一定记得运行 Webpack 前先注释掉这里。</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;Configuration&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">   <span class="keyword">const</span> config = &#123;</span><br><span class="line">     entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">     output: &#123;</span><br><span class="line">     filename: <span class="string">'bundle.js'</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>


<p>需要注意的是：我们添加的 import 语句只是为了导入 Webpack 配置对象的类型，这样做的目的是为了标注 config 对象的类型，从而实现智能提示。在配置完成后一定要记得注释掉这段辅助代码，因为在 Node.js 环境中默认还不支持 import 语句，如果执行这段代码会出现错误。</p>
<p>所以我一般的做法是直接在类型注释中使用 import 动态导入类型，具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type <span class="type">&#123;import('webpack').Configuration&#125;</span> </span>*/</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = config</span><br></pre></td></tr></table></figure>


<p>这种方式同样也可以实现载入类型，而且相比于在代码中通过 import 语句导入类型更为方便，也更为合理。</p>
<p>不过需要注意一点，这种导入类型的方式并不是 ES Modules 中的 Dynamic Imports，而是 TypeScript 中提供特性。虽然我们这里只是一个 JavaScript 文件，但是在 VSCode 中的类型系统都是基于 TypeScript 的，所以可以直接按照这种方式使用，详细信息你可以参考这种 import-types 的文档。</p>
<p>其次，这种 @type 类型注释的方式是基于 JSDoc 实现的。JSDoc 中类型注释的用法还有很多，详细可以参考官方文档中对 @type 标签的介绍。<a href="https://jsdoc.app/index.html" target="_blank" rel="noopener">https://jsdoc.app/index.html</a></p>
<p>#####Webpack 工作模式</p>
<blockquote>
<p><a href="https://webpack.js.org/configuration/mode/" target="_blank" rel="noopener">https://webpack.js.org/configuration/mode/</a></p>
</blockquote>
<p>Webpack 4 新增了一个工作模式的用法，这种用法大大简化了 Webpack 配置的复杂程度。你可以把它理解为针对不同环境的几组预设配置：</p>
<ul>
<li>production 模式下，启动内置优化插件，自动优化打包结果，打包速度偏慢；</li>
<li>development 模式下，自动优化打包速度，添加一些调试过程中的辅助插件；</li>
<li>none 模式下，运行最原始的打包，不做任何额外处理。</li>
</ul>
<p>针对工作模式的选项，如果你没有配置一个明确的值，打包过程中命令行终端会打印一个对应的配置警告。在这种情况下 Webpack 将默认使用 production 模式去工作。</p>
<p>修改 Webpack 工作模式的方式有两种：</p>
<ul>
<li>通过 CLI –mode 参数传入；</li>
<li>通过配置文件设置 mode 属性。</li>
</ul>
<p>打包结果运行原理<br>最后，我们来一起学习 Webpack 打包后生成的 bundle.js 文件，深入了解 Webpack 是如何把这些模块合并到一起，而且还能正常工作的。</p>
<p>为了更好的理解打包后的代码，我们先将 Webpack 工作模式设置为 none，这样 Webpack 就会按照最原始的状态进行打包，所得到的结果更容易理解和阅读。</p>
<p>按照 none 模式打包完成后，我们打开最终生成的 bundle.js 文件，如下图所示：</p>
<p><img src="/blog/.io//image-20200706002840563.png" alt="image-20200706002840563"></p>
<p>我们可以先把代码全部折叠起来，以便于了解整体的结构，如下图所示：</p>
<blockquote>
<p>VSCode 中折叠代码的快捷键是 Ctrl + K，Ctrl + 0(macOS：Command + K,Command + 0)</p>
</blockquote>
<p><img src="/blog/.io//image-20200706002900825.png" alt="image-20200706002900825"></p>
<p>整体生成的代码其实就是一个立即执行函数，这个函数是 Webpack 工作入口（webpackBootstrap），它接收一个 modules 参数，调用时传入了一个数组。</p>
<p>展开这个数组，里面的元素均是参数列表相同的函数。这里的函数对应的就是我们源代码中的模块，也就是说每个模块最终被包裹到了这样一个函数中，从而实现模块私有作用域，如下图所示：</p>
<p><img src="/blog/.io//image-20200706003053538.png" alt="image-20200706003053538"></p>
<p>我们再来展开 Webpack 工作入口函数，如下图所示：</p>
<p><img src="/blog/.io//image-20200706003115366.png" alt="image-20200706003115366"></p>
<p>这个函数内部并不复杂，而且注释也很清晰，最开始定义了一个 installedModules 对象用于存放或者缓存加载过的模块。紧接着定义了一个 require 函数，顾名思义，这个函数是用来加载模块的。再往后就是在 require 函数上挂载了一些其他的数据和工具函数，这些暂时不用关心。</p>
<p>这个函数执行到最后调用了 require 函数，传入的模块 id 为 0，开始加载模块。模块 id 实际上就是模块数组的元素下标，也就是说这里开始加载源代码中所谓的入口模块。</p>
<p>为了更好的理解 bundle.js 的执行过程，可以把它运行到浏览器中，然后通过 Chrome 的 Devtools 单步调试一下。</p>
<p>#####Webpack 运行机制</p>
<p><strong>Webpack 核心工作过程中的关键环节</strong>：</p>
<ul>
<li>Webpack CLI 启动打包流程；</li>
<li>载入 Webpack 核心模块，创建 Compiler 对象；<ul>
<li>webpack核心模块会根据配置选项去构建compiler对象，可分多路打包和单路打包。</li>
<li>多路打包相当与再次调用webpack函数，通过MultiCompiler类获得compiler对象；单路打包会解析配置选项覆盖默认选项，接着通过Compiler类获得compiler对象，将解析好的options配置对象挂载到compiler上。</li>
<li>紧接着注册已配置的插件，调用环境变量钩子和注册内置的插件</li>
<li>最后返回compiler对象</li>
</ul>
</li>
<li>使用 Compiler 对象开始编译整个项目；<ul>
<li>执行compiler对象的run方法，会先触发beforeRun和run钩子，再执行compile方法（也就是Compiler类的compile方法），开始真正的编译。</li>
<li>触发beforeCompile和compile钩子，创建compilation上下文对象，再触发make钩子，开始<code>make</code>阶段。</li>
</ul>
</li>
<li>从入口文件开始，解析模块依赖，形成依赖关系树；</li>
<li>递归依赖树，将每个模块交给对应的 Loader 处理；</li>
<li>合并 Loader 处理完的结果，将打包结果输出到 dist 目录。</li>
</ul>
<p><strong>对于 make 阶段后续的基本流程</strong>：</p>
<ul>
<li>SingleEntryPlugin 中调用了 Compilation 对象的 addEntry 方法，开始解析入口；</li>
<li>addEntry 方法中又调用了 _addModuleChain 方法，将入口模块添加到模块依赖列表中；</li>
<li>紧接着通过 Compilation 对象的 buildModule 方法进行模块构建；</li>
<li>buildModule 方法中执行具体的 Loader，处理特殊资源加载；</li>
<li>build 完成过后，通过 acorn 库生成模块代码的 AST 语法树；</li>
<li>根据语法树分析这个模块是否还有依赖的模块，如果有则继续循环 build 每个依赖；</li>
<li>所有依赖解析完成，build 阶段结束；</li>
<li>最后合并生成需要输出的 bundle.js 写入 dist 目录。</li>
</ul>
<h4 id="webpack高阶"><a href="#webpack高阶" class="headerlink" title="webpack高阶"></a>webpack高阶</h4><p>#####DevServer提高开发效率</p>
<p>我们在开发过程中需要时时的看我们的编写结果，我们比较原始的方式就是以 watch 模式工作<code>修改代码 → Webpack 自动打包 → 手动刷新浏览器(http-serve) → 预览运行结果</code>，或者使用BrowserSync工具替换 serve 工具，启动 HTTP 服务，这里还需要同时监听 dist 目录下文件的变化，具体命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以先通过 npm 全局安装 browser-sync 模块，然后再使用这个模块</span></span><br><span class="line">$ npm install browser-sync --global</span><br><span class="line">$ browser-sync dist --watch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者也可以使用 npx 直接使用远端模块</span></span><br><span class="line">$ npx browser-sync dist --watch</span><br></pre></td></tr></table></figure>

<p>它的原理就是 Webpack 监视源代码变化，自动打包源代码到 dist 中，而 dist 中文件的变化又被 BrowserSync 监听了，从而实现自动编译并且自动刷新浏览器的功能，整个过程由两个工具分别监视不同的内容。</p>
<p>这种 watch 模式 + BrowserSync 虽然也实现了我们的需求，但是这种方法有很多弊端：</p>
<ul>
<li><p>操作烦琐，我们需要同时使用两个工具，那么需要了解的内容就会更多，学习成本大大提高；</p>
</li>
<li><p>效率低下，因为整个过程中， Webpack 会将文件写入磁盘，BrowserSync 再进行读取。过程中涉及大量磁盘读写操作，必然会导致效率低下。<br>所以这只能算是“曲线救国”，并不完美，我们仍然需要继续改善。</p>
</li>
</ul>
<p>所以我们可以使用<code>webpack-dev-server</code>，它 Webpack 官方推出的一款开发工具，根据它的名字我们就应该知道，它提供了一个开发服务器，并且将自动编译和自动刷新浏览器等一系列对开发友好的功能全部集成在了一起。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 webpack-dev-server</span></span><br><span class="line">$ npm install webpack-dev-server --save-dev</span><br><span class="line"><span class="comment"># 运行 webpack-dev-server</span></span><br><span class="line">$ npx webpack-dev-server</span><br></pre></td></tr></table></figure>

<p><img src="/blog/.io//image-20200708160621592.png" alt="image-20200708160621592">webpack-dev-server 为了提高工作速率，它并没有将打包结果写入到磁盘中，而是暂时存放在内存中，内部的 HTTP Server 也是从<code>内存</code>中读取这些文件的。这样一来，就会减少很多不必要的磁盘读写操作，大大提高了整体的构建效率。</p>
<p>Webpack 配置对象中可以有一个叫作 devServer 的属性，专门用来为 webpack-dev-server 提供配置，具体如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">'pulic'</span>, <span class="comment">// 指定额外的静态资源路径</span></span><br><span class="line">    compress: <span class="literal">true</span>, <span class="comment">// 开启压缩</span></span><br><span class="line">    port: <span class="number">9000</span>, <span class="comment">// 指定端口，默认8080</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 详细配置文档：https://webpack.js.org/configuration/dev-server/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Proxy 代理解决开发跨域</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: &#123;</span><br><span class="line">        target: <span class="string">'https://api.github.com'</span>, <span class="comment">// 目标地址</span></span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">''</span> <span class="comment">// 替换掉代理地址中的 /api</span></span><br><span class="line">        &#125;,</span><br><span class="line">        changeOrigin: <span class="literal">true</span> <span class="comment">// 确保请求 GitHub 的主机名就是：api.github.com</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>pathRewrite ：最终会以正则的方式来替换请求路径，如果不像上文配置，那此时我们请求 <a href="http://localhost:8080/api/users" target="_blank" rel="noopener">http://localhost:8080/api/users</a> ，就相当于请求了 <a href="https://api.github.com/api/users" target="_blank" rel="noopener">https://api.github.com/api/users</a></li>
<li>changeOrigin ：属性设置为 true，就会以实际代理请求地址中的主机名去请求</li>
</ul>
<h5 id="Source-Map配置"><a href="#Source-Map配置" class="headerlink" title="Source Map配置"></a>Source Map配置</h5><p><em>原理：</em></p>
<p>Source Map（源代码地图）就是解决此类问题最好的办法，从它的名字就能够看出它的作用：映射转换后的代码与源代码之间的关系。一段转换后的代码，通过转换过程中生成的 Source Map 文件就可以逆向解析得到对应的源代码。<img src="/blog/.io//image-20200708183431060.png" alt="image-20200708183431060"></p>
<p>.map是一个 JSON 格式的文件，为了更容易阅读，我提前对该文件进行了格式化。这个 JSON 里面记录的就是转换后和转换前代码之间的映射关系，主要存在以下几个属性：</p>
<ul>
<li>version 是指定所使用的 Source Map 标准版本；</li>
<li>sources 中记录的是转换前的源文件名称，因为有可能出现多个文件打包转换为一个文件的情况，所以这里是一个数组；</li>
<li>names 是源代码中使用的一些成员名称，我们都知道一般压缩代码时会将我们开发阶段编写的有意义的变量名替换为一些简短的字符，这个属性中记录的就是原始的名称；</li>
<li>mappings 属性，这个属性最为关键，它是一个叫作 base64-VLQ 编码的字符串，里面记录的信息就是转换后代码中的字符与转换前代码中的字符之间的映射关系，具体如下图所示：</li>
</ul>
<p><img src="/blog/.io//image-20200708183626164.png" alt="image-20200708183626164"></p>
<p>一般我们会在转换后的代码中通过添加一行注释的方式来去引入 Source Map 文件。不过这个特性只是用于开发调试的，所以最新版本的 jQuery 已经去除了引入 Source Map 的注释，我们需要手动添加回来，这里我们在最后一行添加 <code>//# sourceMappingURL=jquery-3.4.1.min.map</code>，具体效果如下：<img src="/blog/.io//image-20200708183757516.png" alt="image-20200708183757516"></p>
<p><em>配置：</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devtool: <span class="string">'source-map'</span> <span class="comment">// source map 设置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Webpack 中的 devtool 配置，除了可以使用 source-map 这个值，它还支持很多其他的选项，具体的我们可以参考文档中的不同模式的对比表。<img src="/blog/.io//image-20200708184217136.png" alt="image-20200708184217136"></p>
<p>根据上图，总结得出：</p>
<ul>
<li>eval（不生产.map文件，在打包后js模块中）：Webpack 会将每个模块转换后的代码都放到 eval 函数中执行，并且通过 sourceURL 声明对应的文件路径。<code>它只能定位源代码的文件路径，无法知道具体的行列信息</code></li>
<li>inline-source-map：它跟普通的 source-map 效果相同，只不过这种模式下 Source Map 文件不是以物理文件存在，而是以 data URLs 的方式出现在代码中。我们前面遇到的 eval-source-map 也是这种 inline 的方式。</li>
<li>hidden-source-map ：在这个模式下，我们在开发工具中看不到 Source Map 的效果，但是它也确实生成了 Source Map 文件，这就跟 jQuery 一样，虽然生成了 Source Map 文件，但是代码中并没有引用对应的 Source Map 文件，开发者可以自己选择使用。</li>
<li>nosources-source-map ：在这个模式下，我们能看到错误出现的位置（包含行列位置），但是点进去却看不到源代码。这是为了保护源代码在生产环境中不暴露。</li>
<li>其他可得出<code>cheap: 只能定位到行，定位不到列；module：让源代码不转化（不经过Loader） ES6 写法，保持原本写法</code></li>
</ul>
<p>我个人平时开发会选：<code>cheap-module-eval-source-map</code>，而发布前打包则选择 <code>none</code>不代码映射。</p>
<h5 id="热替换（HMR）机制"><a href="#热替换（HMR）机制" class="headerlink" title="热替换（HMR）机制"></a>热替换（HMR）机制</h5><p>配置代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    <span class="comment">// 开启 HMR 特性，如果资源不支持 HMR 会 fallback 到 live reloading</span></span><br><span class="line">    hot: <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 只使用 HMR，不会 fallback 到 live reloading,这样热替换逻辑中的错误信息就可以直接看到（不页面刷新）</span></span><br><span class="line">    <span class="comment">// hotOnly: true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// HMR 特性所需要的插件</span></span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们还是需要自己手动通过代码来处理，可以使用HotModuleReplacementPlugin 为我们的 JavaScript 提供了一套用于处理 HMR 的 API，我们需要在我们自己的代码中，使用这套 API 将更新后的模块替换到正在运行的页面中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HMR -----------------------------------</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123; <span class="comment">// 确保有 HMR API 对象</span></span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">'./sourceUrl'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'更新了'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="高级特性优化项目"><a href="#高级特性优化项目" class="headerlink" title="高级特性优化项目"></a>高级特性优化项目</h5><p>######<em>Tree Shaking</em></p>
<blockquote>
<p>Tree-shaking 并不是指 Webpack 中的某一个配置选项，而是一组功能搭配使用过后实现的效果，这组功能在生产模式下都会自动启用，所以使用生产模式打包就会有 Tree-shaking 的效果。</p>
</blockquote>
<p>功能：移除未引用代码（dead-code）</p>
<p>配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... 其他配置项</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    <span class="comment">// 模块只导出被使用的成员(未开启压缩还可以在模块中看到)</span></span><br><span class="line">    usedExports: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 压缩输出结果</span></span><br><span class="line">    minimize: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 尽可能合并每一个模块到一个函数中，这个特性又被称为 Scope Hoisting，也就是作用域提升，它是 Webpack 3.0 中添加的一个特性。</span></span><br><span class="line">    concatenateModules: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：<em>结合 babel-loader 的问题</em></p>
<p>Tree-shaking 实现的前提是 ES Modules，也就是说：最终交给 Webpack 打包的代码，必须是使用 ES Modules 的方式来组织的模块化。</p>
<p>我们为了更好的兼容性，会选择使用 babel-loader 去转换我们源代码中的一些 ECMAScript 的新特性。而 Babel 在转换 JS 代码时，很有可能处理掉我们代码中的 ES Modules 部分，把它们转换成 CommonJS 的方式。</p>
<p><code>但在最新版本（8.x）的 babel-loader 中，已经自动帮我们关闭了对 ES Modules 转换的插件，所以我们只需要注意我们的 babel-loader的版本即可</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [</span><br><span class="line">              [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">              <span class="comment">// 强制使用 Babel 的 ES Modules 插件把代码中的 ES Modules 转换为 CommonJS</span></span><br><span class="line">              <span class="comment">// ['@babel/preset-env', &#123; modules: 'commonjs' &#125;]</span></span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    usedExports: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>######<em>sideEffects</em></p>
<blockquote>
<p>允许我们通过配置标识我们的代码是否有副作用，从而提供更大的压缩空间。模块的副作用指的就是模块执行的时候除了导出成员，是否还做了其他的事情。</p>
</blockquote>
<p>开启 Tree-shaking 特性（只设置 useExports），这里没有用到的导出成员被移除，打包效果如下：<img src="/blog/.io//image-20200708232156819.png" alt="image-20200708232156819"></p>
<p>但是由于这些成员所属的模块中有副作用代码，所以就导致最终 Tree-shaking 过后，这些模块并不会被完全移除。所以说，<code>Tree-shaking 只能移除没有用到的代码成员，而想要完整移除没有用到的模块，那就需要开启 sideEffects 特性了。</code></p>
<p><code>配置：</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    <span class="comment">// 在 production 模式下同样会自动开启</span></span><br><span class="line">    sideEffects: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Webpack 在打包某个模块之前，会先检查这个模块所属的 package.json 中的 sideEffects 标识，以此来判断这个模块是否有副作用，如果没有副作用的话，这些没用到的模块就不再被打包。换句话说，即便这些没有用到的模块中存在一些副作用代码，我们也可以通过 package.json 中的 sideEffects 去强制声明没有副作用。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"09-side-effects"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"zce &lt;w@zce.me&gt; (https://zce.me)"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.43.0"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.3.11"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 项目中的所有代码都没有副作用,webpack就会将所有未导出模块副作用代码删除</span></span><br><span class="line">  <span class="attr">"sideEffects"</span>: <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 可以指定保留有副作用的模块路径（可以使用通配符）</span></span><br><span class="line">  <span class="comment">//"sideEffects": [</span></span><br><span class="line">  <span class="comment">//  "./src/extend.js",</span></span><br><span class="line">  <span class="comment">//  "*.css"</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结sideEffects配置：</p>
<ul>
<li>webpack.config.js 中的 sideEffects 用来开启这个功能；</li>
<li>package.json 中的 sideEffects 用来标识我们的代码没有副作用。</li>
</ul>
<p>不管是 Tree-shaking 还是 sideEffects，我个人认为，它们都是为了弥补 JavaScript 早期在模块系统设计上的不足。随着 Webpack 这类技术的发展，JavaScript 的模块化确实越来越好用，也越来越合理。</p>
<p>除此之外，我还想说一点，在开发过程中应该意识到：<code>尽可能不要写影响全局的副作用代码。</code></p>
<p>######<em>Code Splitting（分块打包）</em></p>
<p>原因：<code>All in One 的弊端</code>,如果我们的应用非常复杂，模块非常多，那么这种 All in One 的方式就会导致打包的结果过大，甚至超过 4～5M。</p>
<p>在绝大多数的情况下，应用刚开始工作时，并不是所有的模块都是必需的。如果这些模块全部被打包到一起，即便应用只需要一两个模块工作，也必须先把 bundle.js 整体加载进来，而且前端应用一般都是运行在浏览器端，这也就意味着应用的响应速度会受到影响，也会浪费大量的流量和带宽。</p>
<p>更为合理的方案是<code>把打包的结果按照一定的规则分离到多个 bundle 中，然后根据应用的运行需要按需加载</code>。这样就可以降低启动成本，提高响应速度。</p>
<p>可能有同学会疑问，webpack不就是要把多个模块打包一起吗？现在又要拆开？原因很简单：<code>Web 应用中的资源受环境所限，太大不行，太碎更不行</code>。因为我们开发过程中划分模块的颗粒度一般都会非常的细，很多时候一个模块只是提供了一个小工具函数，并不能形成一个完整的功能单元。</p>
<p>而且，目前主流的 HTTP 1.1 本身就存在一些缺陷，例如：</p>
<ul>
<li>同一个域名下的<code>并行请求</code>是有限制的；</li>
<li>每次请求本身都会有一定的<code>延迟</code>；</li>
<li>每次请求除了传输内容，还有额外的<code>请求头</code>，大量请求的情况下，这些请求头加在一起也会浪费流量和带宽。</li>
</ul>
<p>实现方案：</p>
<ul>
<li>根据业务不同配置多个打包入口，输出多个打包结果；</li>
<li>结合 ES Modules 的动态导入（Dynamic Imports）特性，按需加载模块。</li>
</ul>
<p><em>多入口打包配置</em>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    main: <span class="string">'./src/main.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span> <span class="comment">// [name] 是入口名称</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ... 其他配置</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">'Multi Entry'</span>,</span><br><span class="line">      template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">      filename: <span class="string">'index.html'</span>,</span><br><span class="line">      chunks: [<span class="string">'index'</span>] <span class="comment">// 指定使用 index.bundle.js</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      title: <span class="string">'Multi Entry'</span>,</span><br><span class="line">      template: <span class="string">'./src/main.html'</span>,</span><br><span class="line">      filename: <span class="string">'main.html'</span>,</span><br><span class="line">      chunks: [<span class="string">'main'</span>] <span class="comment">// 指定使用 main.bundle.js</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      <span class="comment">// 自动提取所有公共模块到单独 bundle</span></span><br><span class="line">      chunks: <span class="string">'all'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>动态导入</em></p>
<blockquote>
<p>为了动态导入模块，可以将 import 关键字作为函数调用。当以这种方式使用时，import 函数返回一个 Promise 对象。这就是 ES Modules 标准中的 Dynamic Imports。</p>
</blockquote>
<p><img src="/blog/.io//image-20200709121257273.png" alt="image-20200709121257273"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/App.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Home,</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      isShow: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onToggle() &#123;</span><br><span class="line">      <span class="keyword">this</span>.isShow = !<span class="keyword">this</span>.isShow</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.isShow) &#123;</span><br><span class="line">        <span class="comment">// 魔法注释，可以给打包后的js文件取名</span></span><br><span class="line">        <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'indexVue' */</span><span class="string">'./components/index.vue'</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: data&#125;</span>) =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'mainVue' */</span><span class="string">'./components/main.vue'</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: data&#125;</span>) =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="优化Webpack的构建速度和打包结果"><a href="#优化Webpack的构建速度和打包结果" class="headerlink" title="优化Webpack的构建速度和打包结果"></a>优化Webpack的构建速度和打包结果</h5><p>我们先为不同的工作环境创建不同的 Webpack 配置。创建不同环境配置的方式主要有两种：</p>
<ul>
<li>在配置文件中添加相应的判断条件，根据环境不同导出不同配置。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 终端命令</span><br><span class="line">// 项目打包</span><br><span class="line">webpack --env=production</span><br><span class="line">// 项目启动</span><br><span class="line">webpack-dev-server --env=development</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env, argv</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> config = &#123;</span><br><span class="line">        <span class="comment">// ... 不同模式下的公共配置</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (env === <span class="string">'development'</span>) &#123;</span><br><span class="line">      <span class="comment">// 为 config 添加开发模式下的特殊配置</span></span><br><span class="line">      config.mode = <span class="string">'development'</span></span><br><span class="line">      config.devtool = <span class="string">'cheap-eval-module-source-map'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (env === <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="comment">// 为 config 添加生产模式下的特殊配置</span></span><br><span class="line">      config.mode = <span class="string">'production'</span></span><br><span class="line">      config.devtool = <span class="string">'none'</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>为不同环境单独添加一个配置文件，一个环境对应一个配置文件。</li>
</ul>
<p>一般在这种方式下，项目中最少会有三个 webpack 的配置文件。其中两个用来分别适配开发环境和生产环境，另外一个则是公共配置。因为开发环境和生产环境的配置并不是完全不同的，所以需要一个公共文件来抽象两者相同的配置。具体配置文件结构如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├── <span class="selector-tag">webpack</span><span class="selector-class">.common</span><span class="selector-class">.js</span> ···························· 公共配置</span><br><span class="line">├── <span class="selector-tag">webpack</span><span class="selector-class">.dev</span><span class="selector-class">.js</span> ······························· 开发模式配置</span><br><span class="line">└── <span class="selector-tag">webpack</span><span class="selector-class">.prod</span><span class="selector-class">.js</span> ······························ 生产模式配置</span><br></pre></td></tr></table></figure>

<p>合并对象，覆盖公共的配置对象我们可以使用Object.assign，或者使用 Lodash 提供的 merge 函数来实现，不过社区中提供了更为专业的模块 webpack-merge，它专门用来满足我们这里合并 Webpack 配置的需求。</p>
<p>我们可以先通过 npm 安装一下 webpack-merge 模块。具体命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i webpack-merge --save-dev </span><br><span class="line">$ yarn add webpack-merge --dev</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.common.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... 公共配置</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ./webpack.prod.js</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  <span class="comment">// 生产模式配置</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ./webpack.dev.jss</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  <span class="comment">// 开发模式配置</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>分别配置完成过后，我们再次回到命令行终端，然后尝试运行 webpack 打包。不过因为这里已经没有默认的配置文件了，所以我们需要通过 –config 参数来指定我们所使用的配置文件路径。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ webpack --config webpack.prod.js</span><br></pre></td></tr></table></figure>

<p><em>生产模式下的优化插件</em></p>
<ul>
<li>Define Plugin：为代码中注入全局成员</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ... 其他配置</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="comment">// 值要求的是一个代码片段（如果只是字符串的，调用就会变成变量报错）</span></span><br><span class="line">      API_BASE_URL: <span class="built_in">JSON</span>.stringify(<span class="string">'https://api.example.com'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./src/main.js</span></span><br><span class="line"><span class="built_in">console</span>.log(API_BASE_URL) <span class="comment">// https://api.example.com</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Mini CSS Extract Plugin：可以将 CSS 代码从打包结果中提取出来的插件</li>
<li>Optimize CSS Assets Webpack Plugin: 压缩CSS文件</li>
</ul>
<blockquote>
<p>CSS 体积不是很大的话，提取到单个文件中，效果可能适得其反，因为单独的文件就需要单独请求一次。个人认为是如果 CSS 超过<em>200KB</em>才需要考虑是否提取出来，作为单独的文件。</p>
</blockquote>
<p>安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i mini-css-extract-plugin --save-dev</span><br><span class="line">$ npm i optimize-css-assets-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// 'style-loader', // 将样式通过 style 标签注入</span></span><br><span class="line">          MiniCssExtractPlugin.loader,<span class="comment">//样式就会存放在独立的文件中，直接通过 link 标签引入页面, CSS样式不会压缩，只会压缩js代码</span></span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(),</span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsWebpackPlugin() <span class="comment">// 压缩css代码</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优化压缩：</p>
<blockquote>
<p>如果我们配置到 plugins 属性中，那么这个插件在任何情况下都会工作。而配置到 minimizer 中，就只会在 minimize 特性开启时才工作</p>
</blockquote>
<p>需额外安装内置的 JS 压缩插件叫作 terser-webpack-plugin，因为我们设置了 minimizer，Webpack 认为我们需要使用<code>自定义压缩器插件</code>，那内部的 JS 压缩器就会被覆盖掉</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i terser-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">'terser-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimize: <span class="literal">true</span>, <span class="comment">// 压缩功能需要开启，生产可不需要</span></span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="keyword">new</span> TerserWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCssAssetsWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="其他打包工具"><a href="#其他打包工具" class="headerlink" title="其他打包工具"></a>其他打包工具</h3><h4 id="Rollup"><a href="#Rollup" class="headerlink" title="Rollup"></a>Rollup</h4><p>Rollup 是一款 ES Modules 打包器。它也可以将项目中散落的细小模块打包为整块代码，从而使得这些划分的模块可以更好地运行在浏览器环境或者 Node.js 环境。它的初衷只是希望能够<code>提供一个高效的 ES Modules 打包器，充分利用 ES Modules 的各项特性，构建出结构扁平，性能出众的类库。</code></p>
<p><em>安装</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i rollup --save-dev</span><br></pre></td></tr></table></figure>

<p><em>准备结构</em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="selector-tag">src</span></span><br><span class="line">│   ├── <span class="selector-tag">index</span><span class="selector-class">.js</span></span><br><span class="line">│   ├── <span class="selector-tag">logger</span><span class="selector-class">.js</span></span><br><span class="line">│   └── <span class="selector-tag">messages</span><span class="selector-class">.js</span></span><br><span class="line">└── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br></pre></td></tr></table></figure>

<p><em>示例代码</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/messages.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  hi: <span class="string">'Hey Guys, I am zce~'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ./src/logger.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> log = <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'---------- INFO ----------'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(msg)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'--------------------------'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> error = <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'---------- ERROR ----------'</span>)</span><br><span class="line">  <span class="built_in">console</span>.error(msg)</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'---------------------------'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ./src/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; log &#125; <span class="keyword">from</span> <span class="string">'./logger'</span></span><br><span class="line"><span class="keyword">import</span> messages <span class="keyword">from</span> <span class="string">'./messages'</span></span><br><span class="line">log(messages.hi)</span><br></pre></td></tr></table></figure>

<p><em>打包</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx rollup ./src/index.js --file ./dist/bundle.js</span><br></pre></td></tr></table></figure>

<blockquote>
<p> Rollup 默认会自动开启 Tree-shaking 优化输出结果，Tree-shaking 的概念最早也就是 Rollup 这个工具提出的。</p>
</blockquote>
<p>我们也可以配置文件, 而不再命令行写</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> .</span><br><span class="line"> ├── <span class="selector-tag">src</span></span><br><span class="line"> │   ├── <span class="selector-tag">index</span><span class="selector-class">.js</span></span><br><span class="line"> │   ├── <span class="selector-tag">logger</span><span class="selector-class">.js</span></span><br><span class="line"> │   └── <span class="selector-tag">messages</span><span class="selector-class">.js</span></span><br><span class="line"> ├── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br><span class="line">+└── <span class="selector-tag">rollup</span><span class="selector-class">.config</span><span class="selector-class">.js</span></span><br></pre></td></tr></table></figure>

<p><em>文件配置</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./rollup.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'dist/bundle.js'</span>,</span><br><span class="line">    format: <span class="string">'es'</span> <span class="comment">// 输出格式</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./rollup.config.js</span></span><br><span class="line"><span class="comment">// 所有 Rollup 支持的格式</span></span><br><span class="line"><span class="keyword">const</span> formats = [<span class="string">'es'</span>, <span class="string">'amd'</span>, <span class="string">'cjs'</span>, <span class="string">'iife'</span>, <span class="string">'umd'</span>, <span class="string">'system'</span>]</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> formats.map(<span class="function"><span class="params">format</span> =&gt;</span> (&#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">`dist/bundle.<span class="subst">$&#123;format&#125;</span>.js`</span>,</span><br><span class="line">    format</span><br><span class="line">  &#125;</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p><em>执行命令</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npx rollup --config <span class="comment"># 使用默认配置文件</span></span><br><span class="line">$ npx rollup --config rollup.prod.js <span class="comment"># 指定配置文件路径</span></span><br></pre></td></tr></table></figure>

<p><em>使用插件</em></p>
<p>Rollup 自身的功能就只是 ES Modules 模块的合并，如果有更高级的要求，例如加载其他类型的资源文件或者支持导入 CommonJS 模块，又或是编译 ES 新特性，这些额外的需求 Rollup 同样支持使用插件去扩展实现。</p>
<p>Webpack 中划分了 Loader、Plugin 和 Minimizer 三种扩展方式，而插件是 Rollup 的唯一的扩展方式。</p>
<p>这里我们先来尝试使用一个可以让我们在代码中导入 JSON 文件的插件：@rollup/plugin-json，通过这个过程来了解如何在 Rollup 中使用插件。</p>
<p>首先我们需要将 @rollup/plugin-json 作为项目的开发依赖安装进来。具体安装命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i @rollup/plugin-json --save-dev</span><br></pre></td></tr></table></figure>

<p>安装完成过后，我们打开配置文件。由于 rollup 的配置文件中可以直接使用 ES Modules，所以我们这里使用 import 导入这个插件模块。具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./rollup.config.js</span></span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'@rollup/plugin-json'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'dist/bundle.js'</span>,</span><br><span class="line">    format: <span class="string">'es'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    json()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>插件使用方法基本一致，再提两个功能插件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Rollup 默认只能够按照文件路径的方式加载本地的模块文件，该包直接通过模块名称直接导入</span><br><span class="line">// 加载 NPM 模块</span><br><span class="line">$ npm i @rollup/plugin-node-resolve --save-dev</span><br><span class="line"></span><br><span class="line">// 目前大量的 NPM 模块还是使用 CommonJS 方式导出成员，所以为了兼容这些模块</span><br><span class="line">// 加载 CommonJS 模块</span><br><span class="line">$ npm i @rollup/plugin-commonjs --save-dev</span><br></pre></td></tr></table></figure>

<p><em>Code Splitting</em></p>
<p>Rollup 的最新版本中已经开始支持代码拆分了。我们同样可以使用符合 ES Modules 标准的动态导入方式实现模块的按需加载。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/index.js</span></span><br><span class="line"><span class="comment">// 动态导入的模块会自动分包</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./logger'</span>).then(<span class="function">(<span class="params">&#123; log &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  log(<span class="string">'code splitting~'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在 Rollup 在分包过后会输出多个 JS 文件，需要我们在配置中指定输出的目录，而不是一个具体的文件名，具体配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./rollup.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">// file: 'dist/bundle.js', // code splitting 输出的是多个文件</span></span><br><span class="line">    dir: <span class="string">'dist'</span>,</span><br><span class="line">    format: <span class="string">'es'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>优缺点</em></p>
<p> Rollup 确实有它的优势：</p>
<ul>
<li>输出结果更加扁平，执行效率更高；</li>
<li>自动移除未引用代码；</li>
<li>打包结果依然完全可读。</li>
</ul>
<p>但是它的缺点也同样明显：</p>
<ul>
<li>加载非 ESM 的第三方模块比较复杂；</li>
<li>因为模块最终都被打包到全局中，所以无法实现 HMR；</li>
<li>浏览器环境中，代码拆分功能必须使用 Require.js 这样的 AMD 库</li>
</ul>
<p>总结一下：<code>Webpack 大而全，Rollup 小而美。</code></p>
<p>个人感觉：应用开发使用 Webpack，类库或者框架开发使用 Rollup。</p>
<p>不过这并不是绝对的标准，只是经验法则。因为 Rollup 也可用于构建绝大多数应用程序，而 Webpack 同样也可以构建类库或者框架。</p>
<p>另外随着近几年 Webpack 的发展，Rollup 中的很多优势几乎已经抹平了，所以这种对比慢慢地也就没有太大意义了。</p>
<h4 id="Parcel"><a href="#Parcel" class="headerlink" title="Parcel"></a>Parcel</h4><blockquote>
<p>Parcel 是一款完全零配置的前端打包器，它提供了 “傻瓜式” 的使用体验，我们只需了解它提供的几个简单的命令，就可以直接使用它去构建我们的前端应用程序了。</p>
</blockquote>
<p><em>准备目录</em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="selector-tag">src</span></span><br><span class="line">│   ├── <span class="selector-tag">index</span><span class="selector-class">.html</span></span><br><span class="line">│   ├── <span class="selector-tag">logger</span><span class="selector-class">.js</span></span><br><span class="line">│   └── <span class="selector-tag">main</span><span class="selector-class">.js</span></span><br><span class="line">└── <span class="selector-tag">package</span><span class="selector-class">.json</span></span><br></pre></td></tr></table></figure>

<p><em>安装</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install parcel-bundler --save-dev</span><br></pre></td></tr></table></figure>

<p><em>打包</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npx parcel src/index.html</span><br><span class="line"></span><br><span class="line">// 生产模式打包</span><br><span class="line">$ npx parcel build src/index.html</span><br></pre></td></tr></table></figure>

<p>这里补充一点，相同体量的项目打包，Parcel 的构建速度会比 Webpack 快很多。因为 Parcel 内部使用的是<code>多进程</code>同时工作，充分发挥了多核 CPU 的性能。<code>Webpack 中也可以使用一个叫作 happypack 的插件实现这一点。</code></p>
<blockquote>
<p>虽然 Parcel 跟 Webpack 一样都支持以任意类型文件作为打包入口，不过 Parcel 官方还是建议我们使用 HTML 文件作为入口。官方的理由是 HTML 是应用在浏览器端运行时的入口。</p>
</blockquote>
<p><em>模块热替换</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; log &#125; <span class="keyword">from</span> <span class="string">'./logger'</span></span><br><span class="line">log(<span class="string">'hello parcel'</span>)</span><br><span class="line"><span class="comment">// HMR API</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'HMR～'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不过这里的 accept 方法与 Webpack 提供的 HMR 有点不太一样，Webpack 中的 accept 方法支持接收两个参数，用来处理指定的模块更新后的逻辑。</p>
<p>而这里 Parcel 提供的 accept 只需要接收一个回调参数，作用就是当前模块更新或者所依赖的模块更新过后自动执行传入的回调函数，这相比于之前 Webpack 中的用法要简单很多。</p>
<p>自动安装依赖</p>
<p>在文件保存过后，Parcel 会自动去安装刚刚导入的模块包，极大程度地避免手动操作。</p>
<p><em>动态导入(code splitting)</em></p>
<p>Parcel 同样支持直接使用动态导入，内部也会自动处理代码拆分</p>
<p><em>核心特点</em></p>
<ul>
<li>真正做到了完全零配置，对项目没有任何的侵入；</li>
<li>自动安装依赖，开发过程更专注；</li>
<li>构建速度更快，因为内部使用了多进程同时工作，能够充分发挥多核 CPU 的效率。</li>
</ul>
<p>但是目前看来，如果你去观察开发者的实际使用情况，绝大多数项目的打包还是会选择 Webpack。个人认为原因有两点：</p>
<ul>
<li>Webpack 生态更好，扩展更丰富，出现问题容易解决；</li>
<li>随着这两年的发展，Webpack 越来越好用，开发者也越来越熟悉。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/07/10/webpack%E5%AD%A6%E4%B9%A0/" data-id="ckmm8vaag002d85qs3n2odhnv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Webpack/" rel="tag">Webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bind&amp;call&amp;apply" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/04/04/bind&call&apply/" class="article-date">
  <time datetime="2020-04-04T10:10:10.000Z" itemprop="datePublished">2020-04-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/04/04/bind&call&apply/">bind、call和apply原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="bind、call和apply原理"><a href="#bind、call和apply原理" class="headerlink" title="bind、call和apply原理"></a>bind、call和apply原理</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func.bind(thisArg[, arg1[, arg2[, ...]]])</span><br><span class="line">thisArg 当绑定函数被调用时，该参数会作为原函数运行时的<span class="keyword">this</span>指向。当使用<span class="keyword">new</span> 操作符调用绑定函数时，该参数无效。</span><br><span class="line">arg1, arg2, ... 当绑定函数被调用时，这些参数将置于实参之前传递给被绑定的方法。</span><br></pre></td></tr></table></figure>

<h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func.call(thisArg, arg1, arg2, ...)</span><br><span class="line">thisArg:：在fun函数运行时指定的<span class="keyword">this</span>值。需要注意的是，指定的<span class="keyword">this</span>值并不一定是该函数执行时真正的<span class="keyword">this</span>值，如果这个函数处于非严格模式下，则指定为<span class="literal">null</span>和<span class="literal">undefined</span>的<span class="keyword">this</span>值会自动指向全局对象(浏览器中就是<span class="built_in">window</span>对象)，同时值为原始值(数字，字符串，布尔值)的<span class="keyword">this</span>会指向该原始值的自动包装对象。</span><br><span class="line">arg1, arg2, ... 指定的参数列表。</span><br></pre></td></tr></table></figure>

<h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func.apply(thisArg, [argsArray])</span><br><span class="line">thisArg： 在 fun 函数运行时指定的 <span class="keyword">this</span> 值。需要注意的是，指定的 <span class="keyword">this</span> 值并不一定是该函数执行时真正的 <span class="keyword">this</span> 值，如果这个函数处于非严格模式下，则指定为 <span class="literal">null</span> 或 <span class="literal">undefined</span> 时会自动指向全局对象（浏览器中就是<span class="built_in">window</span>对象），同时值为原始值（数字，字符串，布尔值）的 <span class="keyword">this</span> 会指向该原始值的自动包装对象。</span><br><span class="line">argsArray: 一个数组或者类数组对象，其中的数组元素将作为单独的参数传给 fun 函数。如果该参数的值为<span class="literal">null</span> 或 <span class="literal">undefined</span>，则表示不需要传入任何参数。从ECMAScript <span class="number">5</span> 开始可以使用类数组对象。</span><br></pre></td></tr></table></figure>

<h3 id="原理实现"><a href="#原理实现" class="headerlink" title="原理实现"></a>原理实现</h3><h4 id="bind-1"><a href="#bind-1" class="headerlink" title="bind"></a>bind</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.myBind = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">var</span> context = [].shift.call(<span class="built_in">arguments</span>) || <span class="built_in">window</span><span class="comment">// 保存需要绑定的this上下文</span></span><br><span class="line">    <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>); <span class="comment">//剩下参数转为数组,预设参数</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//预设参数与传入参数拼接</span></span><br><span class="line">        <span class="keyword">return</span> _this.apply(context, [].concat.call(args, [].slice.call(<span class="built_in">arguments</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.myBind = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, ...args</span>) </span>&#123;</span><br><span class="line">  	<span class="keyword">const</span> _this = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> context = ctx || <span class="built_in">window</span> <span class="comment">// 保存需要绑定的this上下文</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _this.apply(context, [].concat.call(args, <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="call-1"><a href="#call-1" class="headerlink" title="call"></a>call</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.myCall = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  	<span class="keyword">var</span> context = [].shift.call(<span class="built_in">arguments</span>);<span class="comment">// 保存需要绑定的this上下文</span></span><br><span class="line">    <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>); <span class="comment">//剩下参数转为数组</span></span><br><span class="line">    context.fn = <span class="keyword">this</span>  <span class="comment">// 保存外部的函数fn</span></span><br><span class="line">    <span class="comment">//var result = context.fn(...args)  // 隐式绑定 调用的外部的fn</span></span><br><span class="line">  	<span class="comment">//代替...扩展符</span></span><br><span class="line">  	<span class="keyword">var</span> argsVarStr = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; args.length; i++)&#123;</span><br><span class="line">      argsVarStr.push(<span class="string">"args["</span> + i +<span class="string">"]"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="keyword">var</span> result = <span class="built_in">eval</span>(<span class="string">"context.fn("</span> + argsVarStr.toString() +<span class="string">")"</span>)</span><br><span class="line">    <span class="keyword">delete</span> context.fn <span class="comment">// 删除新增属性fn</span></span><br><span class="line">  	<span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    a: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用自己的call2方法</span></span><br><span class="line">fn.myCall(obj)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.myCall = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, ...args</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> context = ctx || <span class="built_in">window</span></span><br><span class="line">  context.fn = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">const</span> result = context.fn(...args)</span><br><span class="line">  <span class="keyword">delete</span> context.fn</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="apply-1"><a href="#apply-1" class="headerlink" title="apply"></a>apply</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ES5</span></span><br><span class="line"><span class="comment"> * apply函数传入的是this指向和参数数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.myApply = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> context = ctx || <span class="built_in">window</span>;</span><br><span class="line">    context.fn = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (arr <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'第二个参数需要是数组'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>,len=arr.length;i&lt;len;i++) &#123;</span><br><span class="line">        args.push(<span class="string">"arr["</span> + i + <span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="built_in">eval</span>(<span class="string">"context.fn("</span> + args.toString() + <span class="string">")"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将this指向销毁</span></span><br><span class="line">    <span class="keyword">delete</span> context.fn;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.myApply = <span class="function"><span class="keyword">function</span>(<span class="params">ctx, arr</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">const</span> context = ctx || <span class="built_in">window</span></span><br><span class="line">  <span class="keyword">const</span> context.fn = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(arr) !== <span class="string">'[object Array]'</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'第二个参数需要是数组'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> result = context.fn(...arr)</span><br><span class="line">  <span class="keyword">delete</span> context.fn</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/04/04/bind&call&apply/" data-id="ckmm8va50000985qs0w7seezl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-常用的JS开发技巧（II）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/03/06/%E5%B8%B8%E7%94%A8%E7%9A%84JS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%EF%BC%88II%EF%BC%89/" class="article-date">
  <time datetime="2020-03-06T10:10:10.000Z" itemprop="datePublished">2020-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/03/06/%E5%B8%B8%E7%94%A8%E7%9A%84JS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%EF%BC%88II%EF%BC%89/">常用的JS开发技巧(II)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>判断当前环境是否是手机端</li>
<li>断当前环境是否是微信环境</li>
<li>检测浏览器是否放大</li>
<li>获取普通地址url参数</li>
<li>获取hash模式地址url参数</li>
<li>时间戳转换为目标格式</li>
<li>时间戳距离现在多久以前</li>
<li>生成任意位数随机数(数字)</li>
<li>随机生成一个自定义长度，不重复的字母加数字组合，可用来做id标识</li>
<li>js数组去重(复杂数据有ID的情况下)</li>
<li>浅拷贝</li>
<li>深拷贝</li>
<li>Promise方式封装的Ajax函数</li>
<li>js浮点数计算加减乘除精度损失解决方法</li>
<li>防抖 (debounce)</li>
<li>节流(throttle)</li>
<li>文件大小换算成单位</li>
<li>将一个字符串复制到剪贴板</li>
<li>平滑滚动到页面顶部</li>
</ul>
<blockquote>
<p>如果以上工具函数还未能解你的需求，可以移步查阅<a href="https://segmentfault.com/a/1190000021937948" target="_blank" rel="noopener">JavaScript工具函数大全</a>、<a href="https://mp.weixin.qq.com/s/YmMq1THEObpYU38JlWZGdw" target="_blank" rel="noopener">JavaScript 工具函数大全（新）</a></p>
</blockquote>
<h2 id="函数实现"><a href="#函数实现" class="headerlink" title="函数实现"></a>函数实现</h2><h3 id="1-判断当前环境是否是手机端"><a href="#1-判断当前环境是否是手机端" class="headerlink" title="1.判断当前环境是否是手机端"></a>1.判断当前环境是否是手机端</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断当前环境是否是手机端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span>  </span>返回结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">const</span> isMobile=<span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="regexp">/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i</span>.test(navigator.userAgent)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-断当前环境是否是微信环境"><a href="#2-断当前环境是否是微信环境" class="headerlink" title="2.断当前环境是否是微信环境"></a>2.断当前环境是否是微信环境</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 断当前环境是否是微信环境</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Boolean&#125;</span>  </span>返回结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isWeixin =<span class="function"><span class="params">()</span> =&gt;</span>&#123;      </span><br><span class="line">      <span class="keyword">const</span> ua = navigator.userAgent.toLowerCase();</span><br><span class="line">      <span class="keyword">if</span>(ua.match(<span class="regexp">/MicroMessenger/i</span>)===<span class="string">"micromessenger"</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-检测浏览器是否放大"><a href="#3-检测浏览器是否放大" class="headerlink" title="3.检测浏览器是否放大"></a>3.检测浏览器是否放大</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检测浏览器是否放大</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Boolean &#125;</span> </span>rsize  是否返回具体放大数值,默认否</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Boolean | Number&#125;</span>  </span>返回结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> detectZoom=<span class="function"><span class="params">rsize</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ratio = <span class="number">0</span></span><br><span class="line">  <span class="keyword">const</span> screen = <span class="built_in">window</span>.screen</span><br><span class="line">  <span class="keyword">const</span> ua = navigator.userAgent.toLowerCase()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.devicePixelRatio) &#123;</span><br><span class="line">    ratio = <span class="built_in">window</span>.devicePixelRatio</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (~ua.indexOf(<span class="string">'msie'</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (screen.deviceXDPI &amp;&amp; screen.logicalXDPI) ratio = screen.deviceXDPI / screen.logicalXDPI</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.outerWidth&amp;&amp; <span class="built_in">window</span>.innerWidth) &#123;</span><br><span class="line">    ratio = <span class="built_in">window</span>.outerWidth / <span class="built_in">window</span>.innerWidth</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ratio) ratio = <span class="built_in">Math</span>.round(ratio * <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> rsize ? ratio : ratio === <span class="number">100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-获取普通地址url参数"><a href="#4-获取普通地址url参数" class="headerlink" title="4.获取普通地址url参数"></a>4.获取普通地址url参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取普通地址url参数</span></span><br><span class="line"><span class="comment"> * 例如：http://localhost:8080/?token=rTyJ7bcRb7KU4DMcWo4216&amp;roleId=512213631174180864</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>name </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Boolean | String&#125;</span> </span>返回获取值 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUrlParam = <span class="function"><span class="params">name</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(^|&amp;)"</span> + name + <span class="string">"=([^&amp;]*)(&amp;|$)"</span>); </span><br><span class="line">  <span class="keyword">const</span> r = <span class="built_in">window</span>.location.search.substr(<span class="number">1</span>).match(reg);  </span><br><span class="line">  <span class="keyword">if</span> (r != <span class="literal">null</span>) <span class="keyword">return</span> <span class="built_in">decodeURI</span>(r[<span class="number">2</span>]); <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-获取hash模式地址url参数"><a href="#5-获取hash模式地址url参数" class="headerlink" title="5.获取hash模式地址url参数"></a>5.获取hash模式地址url参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取hash模式地址url参数</span></span><br><span class="line"><span class="comment"> * 例如：http://localhost:8080/#/?token=rTyJ7bcRb7KU4DMcWo4216&amp;roleId=512213631174180864</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>name </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Boolean | String&#125;</span> </span>返回获取值 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUrlHashParam =<span class="function"><span class="params">name</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> w = <span class="built_in">window</span>.location.hash.indexOf(<span class="string">"?"</span>);</span><br><span class="line">  <span class="keyword">const</span> query = <span class="built_in">window</span>.location.hash.substring(w + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> vars = query.split(<span class="string">"&amp;"</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; vars.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> pair = vars[i].split(<span class="string">"="</span>);</span><br><span class="line">    <span class="keyword">if</span> (pair[<span class="number">0</span>] == name) &#123;</span><br><span class="line">      <span class="keyword">return</span> pair[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-时间戳转换为目标格式"><a href="#6-时间戳转换为目标格式" class="headerlink" title="6.时间戳转换为目标格式"></a>6.时间戳转换为目标格式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间戳转换</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>date 时间戳</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>fmt  时间显示格式，例如 yyyy-MM-dd HH:mm:ss</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;String&#125;</span> </span>fmt 返回转换后的时间 ，formatDate(value, "yyyy-MM-dd  hh: mm : ss")</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> formatDate = <span class="function">(<span class="params">date, fmt</span>) =&gt;</span> &#123;</span><br><span class="line">  date = <span class="keyword">new</span> <span class="built_in">Date</span>(date);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(date.getDate())) <span class="keyword">return</span> date;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(y+)/</span>.test(fmt)) &#123;</span><br><span class="line">    fmt = fmt.replace(</span><br><span class="line">      <span class="built_in">RegExp</span>.$<span class="number">1</span>,</span><br><span class="line">      (date.getFullYear() + <span class="string">""</span>).substr(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="string">"M+"</span>: date.getMonth() + <span class="number">1</span>,</span><br><span class="line">    <span class="string">"d+"</span>: date.getDate(),</span><br><span class="line">    <span class="string">"h+"</span>: date.getHours(),</span><br><span class="line">    <span class="string">"m+"</span>: date.getMinutes(),</span><br><span class="line">    <span class="string">"s+"</span>: date.getSeconds()</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`(<span class="subst">$&#123;k&#125;</span>)`</span>).test(fmt)) &#123;</span><br><span class="line">      <span class="keyword">let</span> str = o[k] + <span class="string">""</span>;</span><br><span class="line">      fmt = fmt.replace(</span><br><span class="line">        <span class="built_in">RegExp</span>.$<span class="number">1</span>,</span><br><span class="line">        <span class="built_in">RegExp</span>.$<span class="number">1.</span>length === <span class="number">1</span> ? str : (<span class="string">"00"</span> + str).substr(str.length)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fmt;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="7-时间戳距离现在多久以前"><a href="#7-时间戳距离现在多久以前" class="headerlink" title="7.时间戳距离现在多久以前"></a>7.时间戳距离现在多久以前</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间戳转换成什么之前</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>times 时间戳</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;String&#125;</span> </span>返回结果，timeAgoLabel(1606273724459) 输出：刚刚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> timeAgoLabel = <span class="function"><span class="params">times</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> nowTimes = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()</span><br><span class="line">  <span class="keyword">let</span> diffSecond = (nowTimes - times) / <span class="number">1000</span></span><br><span class="line">  <span class="keyword">let</span> agoLabel = <span class="string">''</span></span><br><span class="line">  <span class="keyword">if</span> (diffSecond &lt; <span class="number">60</span>) &#123;</span><br><span class="line">    agoLabel = <span class="string">'刚刚'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diffSecond &lt; <span class="number">60</span> * <span class="number">60</span>) &#123;</span><br><span class="line">    agoLabel = <span class="built_in">Math</span>.floor(diffSecond / <span class="number">60</span>) + <span class="string">'分钟前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diffSecond &lt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>) &#123;</span><br><span class="line">    agoLabel = <span class="built_in">Math</span>.floor(diffSecond / <span class="number">3600</span>) + <span class="string">'小时前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diffSecond &lt; <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span>) &#123;</span><br><span class="line">    agoLabel = <span class="built_in">Math</span>.floor(diffSecond / (<span class="number">3600</span> * <span class="number">24</span>)) + <span class="string">'天前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diffSecond &lt; <span class="number">3600</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">12</span>) &#123;</span><br><span class="line">    agoLabel = <span class="built_in">Math</span>.floor(diffSecond / (<span class="number">3600</span> * <span class="number">24</span> * <span class="number">30</span>)) + <span class="string">'月前'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    agoLabel = <span class="built_in">Math</span>.floor(diffSecond / (<span class="number">3600</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">12</span>)) + <span class="string">'年前'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> agoLabel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-生成任意位数随机数-数字"><a href="#8-生成任意位数随机数-数字" class="headerlink" title="8.生成任意位数随机数(数字)"></a>8.生成任意位数随机数(数字)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成任意位数随机数(数字)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>n 可选长度位数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Number&#125;</span> </span>返回随机值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> randomNumber =<span class="function"><span class="params">n</span> =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">let</span> rnd = <span class="string">''</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        rnd += <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> rnd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-随机生成一个自定义长度，不重复的字母加数字组合，可用来做id标识"><a href="#9-随机生成一个自定义长度，不重复的字母加数字组合，可用来做id标识" class="headerlink" title="9.随机生成一个自定义长度，不重复的字母加数字组合，可用来做id标识"></a>9.随机生成一个自定义长度，不重复的字母加数字组合，可用来做id标识</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成一个自定义长度，不重复的字母加数字组合，可用来做id标识</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>randomLength 可选长度位数，默认10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;String&#125;</span> </span>返回随机值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> randomId =<span class="function">(<span class="params">randomLength = <span class="number">10</span></span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Number</span>(<span class="built_in">Math</span>.random().toString().substr(<span class="number">3</span>,randomLength) + <span class="built_in">Date</span>.now()).toString(<span class="number">36</span>)</span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="10-js数组去重-复杂数据有ID的情况下"><a href="#10-js数组去重-复杂数据有ID的情况下" class="headerlink" title="10.js数组去重(复杂数据有ID的情况下)"></a>10.js数组去重(复杂数据有ID的情况下)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * js数组去重(复杂数据有ID的情况下)</span></span><br><span class="line"><span class="comment">  * 方式一(hash)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>repeatArray 含重复数据的数组</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return <span class="type">&#123;Array&#125;</span> </span>返回去重后的数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">const</span> noRepeatArrayHash= <span class="function"><span class="params">repeatArray</span> =&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> hash = &#123;&#125;;</span><br><span class="line">      <span class="keyword">const</span> temp = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; repeatArray.length; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!hash[repeatArray[i].id]) &#123;</span><br><span class="line">              hash[repeatArray[i].id] = <span class="literal">true</span>;</span><br><span class="line">              temp.push(repeatArray[i]);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * js数组去重(复杂数据有ID的情况下)</span></span><br><span class="line"><span class="comment">  * 方式二(hash + reduce)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>repeatArray 含重复数据的数组</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return <span class="type">&#123;Array&#125;</span> </span>返回去重后的数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> noRepeatArrayReduce= <span class="function"><span class="params">repeatArray</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> hash = &#123;&#125;;</span><br><span class="line">	<span class="keyword">return</span> repeatArray.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">accumulator, currentValue</span>)</span>&#123;</span><br><span class="line">	       <span class="keyword">if</span>(!hash[currentValue.id])&#123;</span><br><span class="line">		       hash[currentValue.id]=<span class="literal">true</span>;</span><br><span class="line">			   accumulator.push(currentValue)</span><br><span class="line">           &#125;  </span><br><span class="line">           </span><br><span class="line">        <span class="keyword">return</span> accumulator		   </span><br><span class="line">	</span><br><span class="line">	&#125;, []);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-浅拷贝"><a href="#11-浅拷贝" class="headerlink" title="11.浅拷贝"></a>11.浅拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 浅拷贝</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array | Object&#125;</span> </span>objOrArr 要拷贝的对象或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Array | Object&#125;</span> </span>返回拷贝结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> shallowCopy = <span class="function"><span class="params">objOrArr</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> type = objOrArr <span class="keyword">instanceof</span> <span class="built_in">Array</span> ? <span class="string">'array'</span> : <span class="string">'object'</span></span><br><span class="line">    <span class="keyword">let</span> newObjOrArr = objOrArr <span class="keyword">instanceof</span> <span class="built_in">Array</span> ? [] : &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(type === <span class="string">'array'</span>)&#123;</span><br><span class="line">        newObjOrArr=[].concat(objOrArr)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> objOrArr)&#123;</span><br><span class="line">            <span class="keyword">if</span>(objOrArr.hasOwnProperty(key))&#123;</span><br><span class="line">                newObjOrArr[key]= objOrArr[key]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newObjOrArr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="12-深拷贝"><a href="#12-深拷贝" class="headerlink" title="12.深拷贝"></a>12.深拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 深拷贝</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array | Object&#125;</span> </span>objOrArr 要拷贝的对象或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Array | Object&#125;</span> </span>返回拷贝结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deepCopy= <span class="function"><span class="params">objOrArr</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> type = objOrArr <span class="keyword">instanceof</span> <span class="built_in">Array</span> ? <span class="string">'array'</span> : <span class="string">'object'</span></span><br><span class="line">    <span class="keyword">let</span> newObjOrArr = objOrArr <span class="keyword">instanceof</span> <span class="built_in">Array</span> ? [] : &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">'array'</span>) &#123;</span><br><span class="line">        newObjOrArr = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(objOrArr))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> objOrArr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (objOrArr.hasOwnProperty(key)) &#123;</span><br><span class="line">                newObjOrArr[key] = <span class="keyword">typeof</span> objOrArr[key] === <span class="string">'object'</span> ? deepCopy(objOrArr[key]) : objOrArr[key]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newObjOrArr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-Promise方式封装的Ajax函数"><a href="#13-Promise方式封装的Ajax函数" class="headerlink" title="13.Promise方式封装的Ajax函数"></a>13.Promise方式封装的Ajax函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * promise方式封装的ajax函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>method 请求方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>params 请求参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ajax=<span class="function">(<span class="params">method,url, params</span>) =&gt;</span>&#123;		</span><br><span class="line">    <span class="comment">//兼容IE		 	</span></span><br><span class="line">    <span class="keyword">const</span> request= <span class="built_in">window</span>.XMLHttpRequest ? 	<span class="keyword">new</span> XMLHttpRequest() : <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>)	</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">            request.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(request.readyState===<span class="number">4</span>)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(request.status===<span class="number">200</span>)&#123;</span><br><span class="line">                                resolve(<span class="built_in">JSON</span>.parse(request.response));</span><br><span class="line">                            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                reject(request.status);</span><br><span class="line">                            &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span>(method.toUpperCase() === <span class="string">"GET"</span>)&#123;</span><br><span class="line">                <span class="keyword">const</span> arr = [];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> params)&#123;</span><br><span class="line">                    arr.push(key + <span class="string">'='</span> + params[key]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">const</span> getData=arr.join(<span class="string">"&amp;"</span>);					</span><br><span class="line">                request.open(<span class="string">"GET"</span>,url +<span class="string">"?"</span>+getData,<span class="literal">true</span>);</span><br><span class="line">                request.send(<span class="literal">null</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(method.toUpperCase() === <span class="string">"POST"</span>)&#123;</span><br><span class="line">                request.open(<span class="string">"POST"</span>,url,<span class="literal">true</span>);</span><br><span class="line">                request.responseType=<span class="string">"json"</span>;</span><br><span class="line">                request.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded;charset=utf-8'</span>);</span><br><span class="line">                request.send(params);</span><br><span class="line"></span><br><span class="line">            &#125;			</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-js浮点数计算加减乘除精度损失解决方法"><a href="#14-js浮点数计算加减乘除精度损失解决方法" class="headerlink" title="14.js浮点数计算加减乘除精度损失解决方法"></a>14.js浮点数计算加减乘除精度损失解决方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js浮点数计算加减乘除精度损失解决方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>a 数值a</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>b 数值b</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>computeType 加减乘除类型 add加  subtract减  multiply乘  divide除</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Number&#125;</span> </span>返回计算结果，floatNumber(0.11, 0.03, 'add')</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> floatNumber = <span class="function">(<span class="params">a, b, computeType</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> isInteger= <span class="function"><span class="params">obj</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.floor(obj) === obj</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> toInteger= <span class="function"><span class="params">floatNum</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> ret = &#123;<span class="attr">times</span>: <span class="number">1</span>, <span class="attr">num</span>: <span class="number">0</span>&#125;</span><br><span class="line">        <span class="keyword">if</span> (isInteger(floatNum)) &#123;</span><br><span class="line">            ret.num = floatNum</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> strfi  = floatNum + <span class="string">''</span></span><br><span class="line">        <span class="keyword">const</span> dotPos = strfi.indexOf(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">const</span> len    = strfi.substr(dotPos+<span class="number">1</span>).length</span><br><span class="line">        <span class="keyword">const</span> times  = <span class="built_in">Math</span>.pow(<span class="number">10</span>, len)</span><br><span class="line">        <span class="keyword">const</span> intNum = <span class="built_in">parseInt</span>(floatNum * times + <span class="number">0.5</span>, <span class="number">10</span>)</span><br><span class="line">        ret.times  = times</span><br><span class="line">        ret.num    = intNum</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> operation=<span class="function">(<span class="params">a, b, computeType</span>) =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> o1 = toInteger(a)</span><br><span class="line">        <span class="keyword">const</span> o2 = toInteger(b)</span><br><span class="line">        <span class="keyword">const</span> n1 = o1.num</span><br><span class="line">        <span class="keyword">const</span> n2 = o2.num</span><br><span class="line">        <span class="keyword">const</span> t1 = o1.times</span><br><span class="line">        <span class="keyword">const</span> t2 = o2.times</span><br><span class="line">        <span class="keyword">const</span> max = t1 &gt; t2 ? t1 : t2</span><br><span class="line">        <span class="keyword">let</span> result = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">switch</span> (computeType) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'add'</span>:</span><br><span class="line">                <span class="keyword">if</span> (t1 === t2) &#123; <span class="comment">// 两个小数位数相同</span></span><br><span class="line">                    result = n1 + n2</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t1 &gt; t2) &#123; <span class="comment">// o1 小数位 大于 o2</span></span><br><span class="line">                    result = n1 + n2 * (t1 / t2)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// o1 小数位 小于 o2</span></span><br><span class="line">                    result = n1 * (t2 / t1) + n2</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result / max</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'subtract'</span>:</span><br><span class="line">                <span class="keyword">if</span> (t1 === t2) &#123;</span><br><span class="line">                    result = n1 - n2</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t1 &gt; t2) &#123;</span><br><span class="line">                    result = n1 - n2 * (t1 / t2)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    result = n1 * (t2 / t1) - n2</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result / max</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'multiply'</span>:</span><br><span class="line">                result = (n1 * n2) / (t1 * t2)</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'divide'</span>:</span><br><span class="line">                result = (n1 / n2) * (t2 / t1)</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> operation(a, b, computeType)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-防抖-debounce"><a href="#15-防抖-debounce" class="headerlink" title="15.防抖 (debounce)"></a>15.防抖 (debounce)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 防抖 (debounce)将多次高频操作优化为只在最后一次执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn 需要防抖函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>wait  需要延迟的毫秒数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>immediate 可选参，设为true，debounce会在wait时间间隔的开始时立即调用这个函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Function&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> debounce= <span class="function">(<span class="params">fn, wait, immediate</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> args = <span class="built_in">arguments</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (immediate &amp;&amp; !timer) &#123;</span><br><span class="line">            fn.apply(context, args)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (timer) clearTimeout(timer)</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            fn.apply(context, args)</span><br><span class="line">        &#125;, wait)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-节流-throttle"><a href="#16-节流-throttle" class="headerlink" title="16.节流(throttle)"></a>16.节流(throttle)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 节流(throttle)将高频操作优化成低频操作，每隔 100~500 ms执行一次即可</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>fn 需要防抖函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>wait  需要延迟的毫秒数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Boolean&#125;</span> </span>immediate 可选参立即执行，设为true，debounce会在wait时间间隔的开始时立即调用这个函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;Function&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> throttle =<span class="function">(<span class="params">fn, wait, immediate</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> callNow = immediate</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> context = <span class="keyword">this</span>,</span><br><span class="line">            args = <span class="built_in">arguments</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (callNow) &#123;</span><br><span class="line">            fn.apply(context, args)</span><br><span class="line">            callNow = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!timer) &#123;</span><br><span class="line">            timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                fn.apply(context, args)</span><br><span class="line">                timer = <span class="literal">null</span></span><br><span class="line">            &#125;, wait)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-文件大小换算成单位"><a href="#17-文件大小换算成单位" class="headerlink" title="17.文件大小换算成单位"></a>17.文件大小换算成单位</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 文件大小换算成单位</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>bytes 大小</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>units 可选单位，默认metric</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>precision 可选位数，数值精度保留几位小数点，默认1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;String&#125;</span> </span>返回带单位值，byteSize(1580)，输出1.6 kB</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> byteSize = <span class="function">(<span class="params">bytes, units=<span class="string">'metric'</span>, precision=<span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value=<span class="string">''</span>,</span><br><span class="line">        unit=<span class="string">''</span></span><br><span class="line">    <span class="keyword">const</span> base = units === <span class="string">'metric'</span> || units === <span class="string">'metric_octet'</span> ? <span class="number">1000</span> : <span class="number">1024</span></span><br><span class="line">    <span class="keyword">const</span> table = [</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">0</span>, <span class="attr">expTo</span>: <span class="number">1</span>, <span class="attr">metric</span>: <span class="string">'B'</span>, <span class="attr">iec</span>: <span class="string">'B'</span>, <span class="attr">metric_octet</span>: <span class="string">'o'</span>, <span class="attr">iec_octet</span>: <span class="string">'o'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">1</span>, <span class="attr">expTo</span>: <span class="number">2</span>, <span class="attr">metric</span>: <span class="string">'kB'</span>, <span class="attr">iec</span>: <span class="string">'KiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'ko'</span>, <span class="attr">iec_octet</span>: <span class="string">'Kio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">2</span>, <span class="attr">expTo</span>: <span class="number">3</span>, <span class="attr">metric</span>: <span class="string">'MB'</span>, <span class="attr">iec</span>: <span class="string">'MiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'Mo'</span>, <span class="attr">iec_octet</span>: <span class="string">'Mio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">3</span>, <span class="attr">expTo</span>: <span class="number">4</span>, <span class="attr">metric</span>: <span class="string">'GB'</span>, <span class="attr">iec</span>: <span class="string">'GiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'Go'</span>, <span class="attr">iec_octet</span>: <span class="string">'Gio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">4</span>, <span class="attr">expTo</span>: <span class="number">5</span>, <span class="attr">metric</span>: <span class="string">'TB'</span>, <span class="attr">iec</span>: <span class="string">'TiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'To'</span>, <span class="attr">iec_octet</span>: <span class="string">'Tio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">5</span>, <span class="attr">expTo</span>: <span class="number">6</span>, <span class="attr">metric</span>: <span class="string">'PB'</span>, <span class="attr">iec</span>: <span class="string">'PiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'Po'</span>, <span class="attr">iec_octet</span>: <span class="string">'Pio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">6</span>, <span class="attr">expTo</span>: <span class="number">7</span>, <span class="attr">metric</span>: <span class="string">'EB'</span>, <span class="attr">iec</span>: <span class="string">'EiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'Eo'</span>, <span class="attr">iec_octet</span>: <span class="string">'Eio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">7</span>, <span class="attr">expTo</span>: <span class="number">8</span>, <span class="attr">metric</span>: <span class="string">'ZB'</span>, <span class="attr">iec</span>: <span class="string">'ZiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'Zo'</span>, <span class="attr">iec_octet</span>: <span class="string">'Zio'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">expFrom</span>: <span class="number">8</span>, <span class="attr">expTo</span>: <span class="number">9</span>, <span class="attr">metric</span>: <span class="string">'YB'</span>, <span class="attr">iec</span>: <span class="string">'YiB'</span>, <span class="attr">metric_octet</span>: <span class="string">'Yo'</span>, <span class="attr">iec_octet</span>: <span class="string">'Yio'</span> &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; table.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> lower = <span class="built_in">Math</span>.pow(base, table[i].expFrom)</span><br><span class="line">        <span class="keyword">const</span> upper = <span class="built_in">Math</span>.pow(base, table[i].expTo)</span><br><span class="line">        <span class="keyword">if</span> (bytes &gt;= lower &amp;&amp; bytes &lt; upper) &#123;</span><br><span class="line">            <span class="keyword">const</span> retUnit = table[i][units]</span><br><span class="line">            <span class="keyword">if</span> (i === <span class="number">0</span>) &#123;</span><br><span class="line">                value = <span class="built_in">String</span>(bytes)</span><br><span class="line">                unit = retUnit</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = (bytes / lower).toFixed(precision)</span><br><span class="line">                unit = retUnit</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;value&#125;</span> <span class="subst">$&#123;unit&#125;</span>`</span>.trim()  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-将一个字符串复制到剪贴板"><a href="#18-将一个字符串复制到剪贴板" class="headerlink" title="18.将一个字符串复制到剪贴板"></a>18.将一个字符串复制到剪贴板</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将一个字符串复制到剪贴板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>str 复制的内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;String&#125;</span> </span>直接粘贴， copyToClipboard('将一个字符串复制到剪贴板')</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">const</span> copyToClipboard = <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">'textarea'</span>);</span><br><span class="line">      el.value = str;</span><br><span class="line">      el.setAttribute(<span class="string">'readonly'</span>, <span class="string">''</span>);</span><br><span class="line">      el.style.position = <span class="string">'absolute'</span>;</span><br><span class="line">      el.style.left = <span class="string">'-9999px'</span>;</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">      <span class="keyword">const</span> selected =<span class="built_in">document</span>.getSelection().rangeCount &gt; <span class="number">0</span> ? <span class="built_in">document</span>.getSelection().getRangeAt(<span class="number">0</span>) : <span class="literal">false</span>;</span><br><span class="line">      el.select();</span><br><span class="line">      <span class="built_in">document</span>.execCommand(<span class="string">'copy'</span>);</span><br><span class="line">      <span class="built_in">document</span>.body.removeChild(el);</span><br><span class="line">      <span class="keyword">if</span> (selected) &#123;</span><br><span class="line">          <span class="built_in">document</span>.getSelection().removeAllRanges();</span><br><span class="line">          <span class="built_in">document</span>.getSelection().addRange(selected);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="19-平滑滚动到页面顶部"><a href="#19-平滑滚动到页面顶部" class="headerlink" title="19.平滑滚动到页面顶部"></a>19.平滑滚动到页面顶部</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 平滑滚动到页面顶部</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> scrollToTop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;  </span><br><span class="line">    <span class="keyword">const</span> c = <span class="built_in">document</span>.documentElement.scrollTop || <span class="built_in">document</span>.body.scrollTop;  </span><br><span class="line">    <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">    <span class="built_in">window</span>.requestAnimationFrame(scrollToTop);  </span><br><span class="line">    <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, c - c / <span class="number">8</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://supertinypeanut.github.io/blog/2020/03/06/%E5%B8%B8%E7%94%A8%E7%9A%84JS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7%EF%BC%88II%EF%BC%89/" data-id="ckmm8va93002785qs5bc787et" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/blog/">&amp;laquo; 上一页</a><a class="page-number" href="/blog/">1</a><span class="page-number current">2</span><a class="page-number" href="/blog/page/3/">3</a><a class="page-number" href="/blog/page/4/">4</a><a class="extend next" rel="next" href="/blog/page/3/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ECMAScript-6/" rel="tag">ECMAScript 6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Lint/" rel="tag">Lint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/web-%E5%AE%89%E5%85%A8/" rel="tag">web 安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">前端工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" rel="tag">问题解决</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/ECMAScript-6/" style="font-size: 12.5px;">ECMAScript 6</a> <a href="/blog/tags/Git/" style="font-size: 15px;">Git</a> <a href="/blog/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/blog/tags/Lint/" style="font-size: 10px;">Lint</a> <a href="/blog/tags/React/" style="font-size: 12.5px;">React</a> <a href="/blog/tags/TypeScript/" style="font-size: 12.5px;">TypeScript</a> <a href="/blog/tags/Vue/" style="font-size: 17.5px;">Vue</a> <a href="/blog/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/blog/tags/npm/" style="font-size: 10px;">npm</a> <a href="/blog/tags/web-%E5%AE%89%E5%85%A8/" style="font-size: 15px;">web 安全</a> <a href="/blog/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 12.5px;">前端工程化</a> <a href="/blog/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/" style="font-size: 15px;">问题解决</a> <a href="/blog/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 12.5px;">面试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/11/">十一月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2021/03/23/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/">持续集成与持续部署</a>
          </li>
        
          <li>
            <a href="/blog/2021/03/07/Promise%E5%AE%9E%E7%8E%B0/">Promise实现</a>
          </li>
        
          <li>
            <a href="/blog/2021/03/03/ES6%E9%9D%A2%E8%AF%95%E9%A2%98/">ES6面试题</a>
          </li>
        
          <li>
            <a href="/blog/2021/01/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">自动化测试</a>
          </li>
        
          <li>
            <a href="/blog/2020/12/27/async-validator%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">async-validator基本使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Super Peanut<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">

  
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>